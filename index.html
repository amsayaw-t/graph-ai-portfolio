<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marburg Virus Disease Outbreak Monitoring - Ethiopia MoH</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <!-- Use Inter font family -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: 38 38 38;
            /* Deep Charcoal Black */
            --color-secondary: 245 245 245;
            /* Off-White/Light Gray for Contrast */
            --color-accent: 234 179 8;
            /* Gold/Yellow Accent */
            --color-alert: 239 68 68;
            /* Red for high risk */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfcfc;
        }

        /* Custom gradient for hero */
        .hero-gradient {
            /* Black to Dark Violet/Purple */
            background: linear-gradient(135deg, rgb(var(--color-primary)) 0%, #4c1d95 100%);
        }

        /* Gradient for status cards (Keeping Red for ALERT status) */
        .status-gradient-high {
            background: linear-gradient(135deg, rgb(var(--color-alert)) 0%, #b91c1c 100%);
            box-shadow: 0 10px 15px -3px rgba(var(--color-alert), 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .metric-card {
            transition: all 0.3s ease;
            transform: translateY(0);
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.1), 0 6px 10px -3px rgba(0, 0, 0, 0.05);
        }

        /* Custom scrollbar for aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: rgb(var(--color-primary));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #171717;
        }

        /* Animation for Risk Level pulse */
        @keyframes pulse-high {
            0%,
            100% {
                background-color: rgb(var(--color-alert));
            }

            50% {
                background-color: #f87171;
            }
        }

        .animate-pulse-high {
            animation: pulse-high 2s infinite;
        }
        
        /* New style for the moderate risk level */
        .status-gradient-moderate {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); /* Orange */
            box-shadow: 0 10px 15px -3px rgba(249, 115, 22, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Modal specific styling */
        .modal {
            transition: opacity 0.3s ease;
            visibility: hidden;
            opacity: 0;
            z-index: 1000;
        }

        .modal.active {
            visibility: visible;
            opacity: 1;
        }
        
    </style>
</head>

<body>

    <!-- Document Viewer Modal -->
    <div id="document-viewer" class="modal fixed inset-0 bg-gray-900 bg-opacity-95 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-start border-b pb-4 mb-4 sticky top-0 bg-white">
                    <div>
                        <h3 id="doc-title" class="text-2xl font-extrabold text-gray-900">Document Title</h3>
                        <p id="doc-source" class="text-sm text-gray-500 mt-1">Source Information</p>
                    </div>
                    <button id="close-viewer-btn" class="text-gray-500 hover:text-gray-700 transition">
                        <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <div id="doc-content" class="text-gray-700 leading-relaxed text-base">
                    <!-- Document content will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- PIN Access Modal -->
    <div id="pin-modal" class="modal fixed inset-0 bg-gray-900 bg-opacity-95 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-sm w-full p-8 text-gray-900">
            <h3 class="text-xl font-extrabold text-center mb-4">Admin Access Required</h3>
            <p class="text-sm text-gray-600 text-center mb-6">Enter the 4-digit PIN to access the Data Entry Form.</p>
            <form id="pin-form">
                <input type="password" id="pin-input" maxlength="4" required class="w-full p-4 text-center text-2xl font-mono border-2 border-gray-300 rounded-lg tracking-widest focus:border-red-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                <button type="submit" class="w-full mt-6 px-4 py-3 bg-red-700 text-white font-bold rounded-lg hover:bg-red-800 transition">Unlock Data Entry</button>
                <p id="pin-message" class="mt-4 text-sm text-red-600 text-center hidden">Incorrect PIN. Please try again.</p>
            </form>
        </div>
    </div>


    <!-- Navigation Bar -->
    <nav class="sticky top-0 z-50 bg-white shadow-lg backdrop-blur-sm bg-opacity-95">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logos and Title -->
                <div class="flex items-center space-x-3">
                    <!-- MOH Logo -->
                    <img src="https://placehold.co/40x40/B91C1C/FFFFFF?text=MoH" onerror="this.src='https://placehold.co/40x40/B91C1C/FFFFFF?text=MoH'" alt="Ethiopia MoH Logo" class="h-10 w-auto rounded-full shadow-md ring-1 ring-gray-200">
                    <!-- EPHI Logo -->
                    <img src="https://placehold.co/40x40/10B981/FFFFFF?text=EPHI" onerror="this.src='https://placehold.co/40x40/10B981/FFFFFF?text=EPHI'" alt="Ethiopia EPHI Logo" class="h-10 w-auto rounded-full shadow-md ring-1 ring-gray-200">
                    <a href="#" class="flex-shrink-0 flex items-center">
                        <span class="text-xl font-extrabold tracking-tight text-gray-800">Marburg Virus Monitoring System</span>
                    </a>
                </div>

                <div class="hidden md:flex space-x-8 items-center">
                    <a href="#dashboard" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Dashboard</a>
                    <a href="#analysis" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Data Analysis</a>
                    <a href="#report" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Situation Report</a>
                    <a href="#bulletin" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Public Bulletin</a>
                    <a href="#resources" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Resources</a>
                    <a href="#research" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Research</a>
                    
                    <!-- Admin Access Button -->
                    <button id="admin-access-btn" class="px-3 py-1 bg-gray-200 text-gray-800 font-semibold rounded-lg text-sm hover:bg-red-700 hover:text-white transition duration-200">
                        Admin Access
                    </button>
                </div>
                <div class="md:hidden">
                    <button id="menu-button" class="text-gray-600 hover:text-red-700 focus:outline-none">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 flex flex-col">
                <a href="#dashboard" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Dashboard</a>
                <a href="#analysis" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Data Analysis</a>
                <a href="#report" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Situation Report</a>
                 <a href="#bulletin" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Public Bulletin</a>
                <a href="#resources" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Resources</a>
                <a href="#research" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Research</a>
                <button id="admin-access-btn-mobile" class="px-3 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg text-sm hover:bg-red-700 hover:text-white transition duration-200 text-left">Admin Access</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="hero-gradient py-20 sm:py-32 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl sm:text-6xl font-extrabold tracking-tight mb-4">
                Ethiopia Marburg Outbreak Monitoring
            </h1>
            <p class="text-xl sm:text-2xl font-medium text-white max-w-3xl mx-auto">
                Real-time data consolidation and situation reporting from the Ministry of Health.
            </p>
            <div class="mt-8 flex justify-center space-x-4">
                <!-- Changed button text color to black/gray-900 for contrast -->
                <a href="#dashboard" class="px-6 py-3 bg-white text-gray-900 font-bold rounded-xl shadow-lg hover:bg-gray-200 transition duration-300 transform hover:scale-105">
                    View Live Data
                </a>
                <a href="#report" class="px-6 py-3 border-2 border-white text-white font-semibold rounded-xl hover:bg-white hover:text-gray-900 transition duration-300 transform hover:scale-105">
                    Read Latest Report
                </a>
            </div>
            <p id="last-updated-hero" class="mt-6 text-sm opacity-70"></p>
        </div>
    </header>

    <!-- Dashboard Section -->
    <section id="dashboard" class="py-16 sm:py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                Outbreak Dashboard
            </h2>

            <!-- Key Metrics Grid -->
            <div id="metric-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Data will be populated here by JavaScript -->
            </div>
            <p id="dashboard-refresh-note" class="mt-4 text-center text-sm text-gray-500">
                Update metrics using the Data Entry Form at the bottom of the page.
            </p>

            <!-- Risk Level & Action Status -->
            <div class="mt-16 bg-white p-8 rounded-2xl shadow-xl border-t-4 border-gray-700">
                <div class="flex flex-col lg:flex-row items-center justify-between">
                    <div class="mb-4 lg:mb-0">
                        <h3 class="text-2xl font-bold text-gray-800">Current Threat Assessment</h3>
                        <p class="text-gray-600">Consolidated risk level based on verified MoH data.</p>
                    </div>
                    <div id="risk-status" class="status-gradient-high text-white p-4 rounded-xl shadow-2xl text-center min-w-40 animate-pulse-high">
                        <p class="text-sm font-semibold opacity-80">RISK LEVEL</p>
                        <p class="text-3xl font-extrabold mt-1">HIGH</p>
                    </div>
                </div>
                <div id="data-note" class="mt-6 text-sm text-gray-500 border-t pt-4">
                    <p class="font-semibold text-gray-700 mb-1">Data Reconciliation Note:</p>
                    <p>All figures presented are derived exclusively from the Ministry of Health official website and public reports (moh.gov.et, x.com).</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Data Analysis Section (NEW) -->
    <section id="analysis" class="py-16 sm:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                Outbreak Data Analysis
            </h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">

                <!-- Daily Trends (Table - showing NEW cases) -->
                <div class="lg:col-span-1 p-8 rounded-2xl shadow-xl border border-gray-100 border-2 border-gray-200">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-3xl mr-3">üóìÔ∏è</span> Daily New Case Trends
                    </h3>
                    <p class="text-gray-600 mb-6">Confirmed new cases and deaths reported daily over the last 7 days.</p>
                    <div id="daily-trends-container" class="space-y-4 overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">New Cases</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">New Deaths</th>
                                </tr>
                            </thead>
                            <tbody id="daily-trends-data" class="bg-white divide-y divide-gray-200">
                                <!-- Data populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Short-Term Forecasting (Chart - showing CUMULATIVE cases/deaths) -->
                <div class="lg:col-span-2 p-8 rounded-2xl shadow-xl border border-gray-100 bg-gray-50 border-2 border-gray-200">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-3xl mr-3">üîÆ</span> Cumulative Trend & Forecast
                    </h3>
                    <p class="text-gray-600 mb-6">Cumulative cases and deaths shown with a short-term projection (dashed line indicates forecast).</p>
                    <div id="forecasting-container" class="space-y-4">
                        <canvas id="forecastChart" class="w-full h-80"></canvas>
                    </div>
                    <p class="mt-8 text-sm text-gray-500 italic">This chart tracks the overall growth curve. The model estimate (dashed line) is based on simplified epidemiological principles and is subject to change.</p>
                </div>
            </div>

            <!-- Outbreak End Forecast Panel (NEW) -->
            <div class="mt-16 bg-red-50 p-8 rounded-2xl shadow-xl border-l-4 border-red-600">
                <h3 class="text-2xl font-bold text-red-800 mb-4 flex items-center">
                    <span class="text-3xl mr-3">üõë</span> Outbreak End Forecast
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <p class="text-sm font-semibold text-gray-700">Active Cases Used:</p>
                        <p id="forecast-active-cases" class="text-3xl font-extrabold text-red-700 mt-1"></p>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-700">Estimated Final Containment Date (42-Day Clock):</p>
                        <p id="forecast-end-date" class="text-3xl font-extrabold text-gray-900 mt-1"></p>
                    </div>
                    <div class="md:col-span-1">
                         <p class="text-sm font-semibold text-gray-700">Basis for Prediction:</p>
                        <p class="text-sm text-gray-600 mt-1">Requires 42 consecutive days (two maximum incubation periods) with **zero new cases** after the last active patient is discharged/dies. Date is projected from the current "On Treatment" count.</p>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- Public Health Bulletin Section (NEW) -->
    <section id="bulletin" class="py-16 sm:py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                Public Health Bulletin (AI Generated Draft)
            </h2>
            <div class="bg-white p-8 rounded-2xl shadow-2xl border-t-4 border-gray-500">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-3xl mr-3">üó£Ô∏è</span> Official Statement Draft
                </h3>
                <p class="text-gray-600 mb-6">Generate a concise, authoritative public health communication based on the latest internal data and external Marburg context.</p>

                <button id="generate-bulletin-btn" class="w-full md:w-auto px-6 py-3 bg-gray-900 text-white font-bold rounded-xl shadow-lg hover:bg-gray-700 transition duration-300 transform hover:scale-[1.01]">
                    Generate Public Bulletin Draft (via AI)
                </button>

                <div id="bulletin-output" class="mt-8 p-6 bg-gray-100 rounded-xl border border-gray-200 hidden">
                    <p class="text-sm font-semibold text-gray-700 mb-3">MINISTRY OF HEALTH ETHIOPIA: OFFICIAL BULLETIN</p>
                    <div id="bulletin-text" class="text-gray-700 leading-relaxed">
                        <!-- Bulletin content or loading spinner will be inserted here -->
                    </div>
                    <div id="bulletin-sources" class="mt-4 text-xs text-gray-500">
                        <!-- Sources from Gemini API will be inserted here -->
                    </div>
                </div>

                <div id="bulletin-error" class="mt-8 p-4 bg-yellow-100 text-yellow-800 rounded-xl hidden">
                    Could not generate bulletin. Please check the API status or try again.
                </div>
            </div>
        </div>
    </section>
    
    <!-- Situation Report Section -->
    <section id="report" class="py-16 sm:py-24 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                SITUATION REPORT
            </h2>

            <div class="bg-white p-6 md:p-10 rounded-2xl shadow-2xl border border-gray-100">
                <div id="report-header" class="border-b pb-4 mb-6">
                    <p class="text-xs font-bold uppercase tracking-widest text-gray-600">Official Document</p>
                    <h3 id="report-title" class="text-3xl font-extrabold text-gray-800 mt-1"></h3>
                    <p id="report-status" class="mt-1 text-lg font-semibold text-gray-700"></p>
                    <p id="report-date" class="text-sm text-gray-500"></p>
                </div>

                <div id="executive-summary" class="mb-8">
                    <h4 class="text-xl font-bold text-gray-800 mb-3 border-l-4 border-gray-500 pl-3">Executive Summary</h4>
                    <p id="summary-content" class="text-gray-700 leading-relaxed whitespace-pre-line"></p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Section 1: Key Figures -->
                    <div class="lg:col-span-1">
                        <h4 class="text-xl font-bold text-gray-800 mb-3 border-l-4 border-gray-500 pl-3">Key Outbreak Figures</h4>
                        <div id="key-figures" class="space-y-3 p-4 bg-gray-50 rounded-xl">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Section 2: Response & Recommendations -->
                    <div class="lg:col-span-2">
                        <h4 class="text-xl font-bold text-gray-800 mb-3 border-l-4 border-gray-500 pl-3">Immediate Actions & Recommendations</h4>
                        <ul id="recommendations-list" class="space-y-2 text-gray-700 list-disc pl-5">
                            <!-- Populated by JS -->
                        </ul>
                        <p class="mt-6 text-sm italic text-gray-600">These actions are prioritized by the National Incident Management System based on the current risk assessment.</p>
                    </div>
                </div>

                <div class="mt-10 pt-6 border-t">
                    <h4 class="text-xl font-bold text-gray-800 mb-3 border-l-4 border-gray-500 pl-3">Sources of Data</h4>
                    <p id="sources-list" class="text-sm text-gray-600 leading-relaxed">
                        <!-- Populated by JS -->
                    </p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Research and New Findings Section (NEW) -->
    <section id="research" class="py-16 sm:py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                Research & New Findings
            </h2>
            <p class="text-lg text-gray-600 text-center mb-10 max-w-3xl mx-auto">
                Access the latest peer-reviewed research and scientific updates relevant to Marburg Virus Disease epidemiology, diagnostics, and therapeutics.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Ethiopian Research -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-700">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">üá™üáπ</span> National & Regional Research
                    </h3>
                    <ul class="space-y-3">
                        <li>
                            <a href="#" data-doc-id="doc-ephi-genomic" class="document-link font-medium text-red-700 hover:text-red-900 transition underline">
                                Genomic Sequencing of Ethiopian MVD Strains (EPHI Report)
                            </a>
                            <p class="text-sm text-gray-600">Analysis of the current circulating virus strains for mutation detection.</p>
                        </li>
                        <li>
                            <a href="#" data-doc-id="doc-aau-risk" class="document-link font-medium text-red-700 hover:text-red-900 transition underline">
                                Socio-Demographic Risk Factors in Southern Ethiopia MVD Outbreak
                            </a>
                            <p class="text-sm text-gray-600">Addis Ababa University (AAU) study on community transmission drivers.</p>
                        </li>
                        <li>
                            <a href="#" data-doc-id="doc-moh-bat" class="document-link font-medium text-red-700 hover:text-red-900 transition underline">
                                Preliminary Findings on Bat Reservoir Monitoring in Oromia
                            </a>
                            <p class="text-sm text-gray-600">Ecological survey identifying potential zoonotic spillover points.</p>
                        </li>
                    </ul>
                </div>

                <!-- Global Research -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-700">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">üåç</span> Global Scientific Updates
                    </h3>
                    <ul class="space-y-3">
                        <li>
                            <a href="#" data-doc-id="doc-global-vaccine" class="document-link font-medium text-blue-700 hover:text-blue-900 transition underline">
                                Phase 2 Trial Results of Investigational MVD Vaccine (The Lancet)
                            </a>
                            <p class="text-sm text-gray-600">Clinical efficacy and safety data for leading vaccine candidates.</p>
                        </li>
                        <li>
                            <a href="#" data-doc-id="doc-global-mab" class="document-link font-medium text-blue-700 hover:text-blue-900 transition underline">
                                Efficacy of Monoclonal Antibody Treatment for Filoviruses (NEJM)
                            </a>
                            <p class="text-sm text-gray-600">New England Journal of Medicine analysis on antiviral therapies.</p>
                        </li>
                        <li>
                            <a href="#" data-doc-id="doc-global-rdt" class="document-link font-medium text-blue-700 hover:text-blue-900 transition underline">
                                Rapid Diagnostic Test Development for Marburg (Nature Microbiology)
                            </a>
                            <p class="text-sm text-gray-600">Advancements in point-of-care diagnostics for immediate testing.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>


    <!-- Resources and Documents Section -->
    <section id="resources" class="py-16 sm:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                Official Documents & Resources
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Ethiopia National Documents -->
                <div class="bg-gray-50 p-6 rounded-xl shadow-lg border-l-4 border-red-700">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">üá™üáπ</span> National Guidelines
                    </h3>
                    <ul class="space-y-3">
                        <li>
                            <a href="#" data-doc-id="doc-moh-nims" class="document-link font-medium text-red-700 hover:text-red-900 transition underline">
                                Ethiopia MVD National Incident Management Plan (Latest)
                            </a>
                            <p class="text-sm text-gray-600">MoH/EPHI joint policy on outbreak response and coordination.</p>
                        </li>
                        <li>
                            <a href="#" data-doc-id="doc-moh-ipc" class="document-link font-medium text-red-700 hover:text-red-900 transition underline">
                                Infection Prevention Control (IPC) Guidelines for MVD
                            </a>
                            <p class="text-sm text-gray-600">Specific protocols for healthcare workers and burial teams.</p>
                        </li>
                        <li>
                            <a href="#" data-doc-id="doc-moh-riskcomm" class="document-link font-medium text-red-700 hover:text-red-900 transition underline">
                                Community Risk Communication Strategy - Amharic (PDF)
                            </a>
                            <p class="text-sm text-gray-600">Official material for public awareness and messaging.</p>
                        </li>
                    </ul>
                </div>

                <!-- Global and International Documents -->
                <div class="bg-gray-50 p-6 rounded-xl shadow-lg border-l-4 border-blue-700">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">üåç</span> Global & International Standards
                    </h3>
                    <ul class="space-y-3">
                        <li>
                            <a href="#" data-doc-id="doc-global-who" class="document-link font-medium text-blue-700 hover:text-blue-900 transition underline">
                                WHO Marburg Fact Sheet and Q&A
                            </a>
                            <p class="text-sm text-gray-600">Up-to-date global information on the virus and its control.</p>
                        </li>
                        <li>
                            <a href="#" data-doc-id="doc-global-cdc" class="document-link font-medium text-blue-700 hover:text-blue-900 transition underline">
                                CDC Clinical Guidance for MVD Case Management
                            </a>
                            <p class="text-sm text-gray-600">Best practices for treating symptomatic patients and supportive care.</p>
                        </li>
                        <li>
                            <a href="#" data-doc-id="doc-global-ihr" class="document-link font-medium text-blue-700 hover:text-blue-900 transition underline">
                                International Health Regulations (IHR) 2005 Framework
                            </a>
                            <p class="text-sm text-gray-600">Mandatory framework for reporting and responding to severe public health events.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- About Marburg Section -->
    <section id="about" class="py-16 sm:py-24 bg-gray-800 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-center mb-12">
                About Marburg Virus Disease (MVD)
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Card 1: Symptoms -->
                <div class="bg-gray-700 bg-opacity-70 p-6 rounded-xl shadow-xl border-l-4 border-yellow-400">
                    <div class="text-3xl mb-3">ü§ï</div>
                    <h3 class="text-xl font-semibold mb-3">Symptoms & Onset</h3>
                    <p class="text-sm opacity-90">MVD is a severe, often fatal hemorrhagic fever. Initial symptoms (abrupt high fever, severe headache, malaise) begin 2 to 21 days after infection. Later symptoms include severe watery diarrhea, abdominal pain, nausea, and vomiting. Bleeding manifestations may occur 5 to 7 days into the illness.</p>
                </div>
                <!-- Card 2: Transmission -->
                <div class="bg-gray-700 bg-opacity-70 p-6 rounded-xl shadow-xl border-l-4 border-yellow-400">
                    <div class="text-3xl mb-3">ü¶á</div>
                    <h3 class="text-xl font-semibold mb-3">Transmission Pathways</h3>
                    <p class="text-sm opacity-90">The reservoir host is the African fruit bat (*Rousettus aegyptiacus*). Human-to-human transmission occurs through direct contact with blood, secretions, organs, or other body fluids of infected people, and surfaces and materials contaminated with these fluids. </p>
                </div>
                <!-- Card 3: Prevention & Control -->
                <div class="bg-gray-700 bg-opacity-70 p-6 rounded-xl shadow-xl border-l-4 border-yellow-400">
                    <div class="text-3xl mb-3">üßº</div>
                    <h3 class="text-xl font-semibold mb-3">Key Prevention Measures</h3>
                    <p class="text-sm opacity-90">Prevention focuses on reducing the risk of bat-to-human transmission (avoiding fruit bats/caves) and limiting human-to-human spread (safe burials, contact tracing, infection prevention and control (IPC) practices in healthcare settings, and community awareness).</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Data Entry Form (Moved to Bottom) -->
    <section id="data-entry" class="py-16 sm:py-24 bg-red-800 text-white hidden">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-center mb-6">
                Official Data Entry (Admin Only)
            </h2>
            <p class="text-center text-red-100 mb-10">Use this form to update the official national figures for the latest reporting cycle.</p>

            <form id="update-data-form" class="bg-white p-8 rounded-xl shadow-2xl text-gray-900">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <!-- Confirmed Cases -->
                    <div>
                        <label for="confirmed-cases" class="block text-sm font-bold mb-1 text-red-700">Total Confirmed Cases <span class="text-xs font-normal text-gray-500">(All Outcomes)</span></label>
                        <input type="number" id="confirmed-cases" min="0" required class="w-full p-3 border-2 border-red-300 rounded-lg focus:border-red-500">
                    </div>

                    <!-- Tests Conducted -->
                    <div>
                        <label for="tests-conducted" class="block text-sm font-bold mb-1 text-red-700">Total Laboratory Tests Conducted</label>
                        <input type="number" id="tests-conducted" min="0" required class="w-full p-3 border-2 border-red-300 rounded-lg focus:border-red-500">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                    <!-- Deaths -->
                    <div>
                        <label for="deaths" class="block text-sm font-bold mb-1 text-gray-700">Total Deaths</label>
                        <input type="number" id="deaths" min="0" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-red-500">
                    </div>

                    <!-- Recovered -->
                    <div>
                        <label for="recovered" class="block text-sm font-bold mb-1 text-gray-700">Total Recovered Patients</label>
                        <input type="number" id="recovered" min="0" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-red-500">
                    </div>

                    <!-- On Treatment -->
                    <div>
                        <label for="on-treatment" class="block text-sm font-bold mb-1 text-gray-700">Patients On Treatment <span class="text-xs font-normal text-gray-500">(Active Cases)</span></label>
                        <input type="number" id="on-treatment" min="0" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-red-500">
                    </div>
                </div>

                <p id="data-entry-message" class="mt-4 text-center text-sm font-semibold text-red-600"></p>

                <div class="mt-8 text-center">
                    <button type="submit" class="px-8 py-3 bg-red-700 text-white font-bold rounded-xl shadow-lg hover:bg-red-800 transition duration-300 transform hover:scale-[1.01]">
                        Update National Outbreak Data
                    </button>
                </div>
            </form>
        </div>
    </section>

    <!-- Contact & Footer -->
    <footer id="contact" class="bg-gray-800 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h4 class="text-lg font-bold mb-3 text-yellow-400">Ethiopia Ministry of Health (MoH)</h4>
                    <p class="text-sm text-gray-400">
                        Dedicated to protecting the health and well-being of the Ethiopian people through preparedness, surveillance, and response.
                    </p>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-3 text-yellow-400">Quick Links</h4>
                    <ul class="space-y-1 text-sm">
                        <li><a href="#dashboard" class="text-gray-300 hover:text-white transition">Dashboard</a></li>
                        <li><a href="#analysis" class="text-gray-300 hover:text-white transition">Data Analysis</a></li>
                        <li><a href="#report" class="text-gray-300 hover:text-white transition">Situation Report</a></li>
                        <li><a href="#bulletin" class="text-gray-300 hover:text-white transition">Public Bulletin</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-3 text-yellow-400">Contact EOC Team</h4>
                    <p class="text-sm text-gray-400">
                        Public Health Emergency Operations Center (PHEOC)<br>
                        Email: pheoc@moh.gov.et (Mock Address)<br>
                        Hotline: 8383 (National Mock Line)
                    </p>
                </div>
            </div>
            <div class="mt-10 border-t border-gray-700 pt-6 text-center">
                <p class="text-sm text-gray-500">&copy; <span id="year"></span> Ethiopia Ministry of Health. All Rights Reserved. Data for demonstration purposes.</p>
            </div>
        </div>
    </footer>

    <script>
        // --- MOCK DOCUMENT DATABASE ---
        const MVD_DOCUMENTS = {
            "doc-moh-nims": {
                title: "Ethiopia MVD National Incident Management Plan (Latest)",
                source: "Ethiopia Ministry of Health (MoH), 2025",
                content: `
                    <p><strong>Section 1: Activation and Command Structure</strong></p>
                    <p>The National Incident Management System (NIMS) is activated at Level 2 (High Alert). Command is centralized under the Emergency Operations Center (EOC) in Addis Ababa, coordinating regional rapid response teams. Key objectives include preventing inter-regional transmission and securing all identified burial sites.</p>
                    <p><strong>Section 2: Surveillance and Laboratory Capacity</strong></p>
                    <p>Surveillance efforts focus on the Southern and Oromia regions, requiring all healthcare facilities to report suspected viral hemorrhagic fever (VHF) cases within 4 hours. EPHI laboratories maintain 24/7 testing capacity (RT-PCR) with external quality assurance from WHO collaborating centers.</p>
                    <p><strong>Section 3: Logistics and Resource Mobilization</strong></p>
                    <p>Resource priorities include immediate procurement of Level 4 Personal Protective Equipment (PPE), deployment of isolation tent facilities, and mobilization of social mobilization teams for risk communication in high-density areas. International aid coordination is managed through the Ministry of Finance and Economic Development (MoFED).</p>
                `
            },
            "doc-moh-ipc": {
                title: "Infection Prevention Control (IPC) Guidelines for MVD",
                source: "Ethiopian Public Health Institute (EPHI), 2025",
                content: `
                    <p><strong>Universal Precautions:</strong> All patient contact requires full Level 4 PPE (impermeable gown, N95 mask minimum, double gloves, face shield). Hand hygiene protocols (alcohol-based rub or soap and water) must be followed immediately upon doffing and re-donning gloves.</p>
                    <p><strong>Waste Management:</strong> All potentially infectious waste, including linens and sharps, must be segregated at the point of generation into double-bagged biohazard containers and incinerated at designated high-temperature sites only.</p>
                    <p><strong>Burial Protocol:</strong> All confirmed and probable MVD fatalities must be handled by trained, certified burial teams. Traditional washing or direct contact with the body is strictly forbidden. Coffins must be sealed and burials conducted rapidly to prevent community exposure.</p>
                `
            },
            "doc-moh-riskcomm": {
                title: "Community Risk Communication Strategy - Amharic (PDF)",
                source: "Ethiopia Ministry of Health (MoH), 2025",
                content: `
                    <p><strong>Objective:</strong> To minimize community transmission by ensuring 90% awareness of MVD symptoms, transmission routes, and reporting procedures within affected woredas.</p>
                    <p><strong>Key Messages:</strong> 1. Report fever/bleeding immediately (Hotline 8383). 2. Avoid contact with bats and consumption of bushmeat. 3. Trust the official MVD burial teams. 4. Isolate immediately if you have had contact with a known case.</p>
                    <p><strong>Channels:</strong> Utilize regional radio broadcasts, mobile van announcements, local clergy and community leaders, and official social media channels to disseminate information in Amharic, Oromo, and local languages.</p>
                `
            },
            "doc-global-who": {
                title: "WHO Marburg Fact Sheet and Q&A",
                source: "World Health Organization (WHO), November 2025",
                content: `
                    <p><strong>Virus Overview:</strong> Marburg virus is a filovirus, genetically related to Ebola virus. The average case fatality ratio (CFR) across all outbreaks ranges from 24% to 88%, depending on case management and outbreak setting. No approved vaccine or treatment is currently licensed, but several are under evaluation.</p>
                    <p><strong>Treatment:</strong> Treatment is supportive‚Äîbalancing the patient's fluids and electrolytes, maintaining oxygen status and blood pressure, replacing lost blood and clotting factors, and treating any co-existing infections.</p>
                    <p><strong>Global Risk:</strong> MVD poses a global public health risk due to its high CFR and potential for rapid spread in settings with poor infection control. Enhanced global surveillance and cross-border cooperation are essential for rapid containment.</p>
                `
            },
            "doc-global-cdc": {
                title: "CDC Clinical Guidance for MVD Case Management",
                source: "U.S. Centers for Disease Control and Prevention (CDC)",
                content: `
                    <p><strong>Clinical Manifestations:</strong> The illness progresses rapidly from non-specific flu-like symptoms to multi-organ failure and shock. Patients often present with profound fatigue and lack of energy early on. Non-bloody vomiting and diarrhea often start by day 3.</p>
                    <p><strong>Fluid Management:</strong> Aggressive intravenous fluid resuscitation is necessary due to severe fluid loss from diarrhea and vomiting. Careful hemodynamic monitoring is required to prevent pulmonary edema.</p>
                    <p><strong>Antivirals:</strong> While no approved treatment exists, clinical trials of investigational therapeutics (monoclonal antibodies and antivirals) may be available under emergency use protocols. Clinicians must consult the EOC before administering investigational drugs.</p>
                `
            },
            "doc-global-ihr": {
                title: "International Health Regulations (IHR) 2005 Framework",
                source: "World Health Organization (WHO)",
                content: `
                    <p><strong>Purpose:</strong> The IHR (2005) is an international legal instrument that binds 196 countries, including Ethiopia. Its aim is to prevent, protect against, control, and provide a public health response to the international spread of disease in ways that are commensurate with and restricted to public health risks, and which avoid unnecessary interference with international traffic and trade.</p>
                    <p><strong>Mandate for Reporting:</strong> States Parties must notify WHO of all events that may constitute a Public Health Emergency of International Concern (PHEIC) within 24 hours of assessment.</p>
                `
            },
            "doc-ephi-genomic": {
                title: "Genomic Sequencing of Ethiopian MVD Strains (EPHI Report)",
                source: "EPHI National Reference Laboratory, Preliminary Report",
                content: `
                    <p><strong>Finding:</strong> Preliminary sequencing of samples from four confirmed cases indicates the virus strain belongs to the Marburg virus subtype associated with past outbreaks in East Africa. No significant novel mutations affecting transmissibility or vaccine efficacy targets have been detected in the current cluster.</p>
                    <p><strong>Implication:</strong> The current data suggests that the existing knowledge base and investigational medical countermeasures (e.g., vaccine candidates) remain relevant for the current strain.</p>
                `
            },
            "doc-aau-risk": {
                title: "Socio-Demographic Risk Factors in Southern Ethiopia MVD Outbreak",
                source: "Addis Ababa University (AAU), Faculty of Public Health",
                content: `
                    <p><strong>Key Finding:</strong> The highest risk factor for initial human infection was traced to contact with bat habitats (caves, mines). Secondary transmission clusters were primarily linked to traditional burial practices and lapses in Infection Prevention Control (IPC) in small rural clinics.</p>
                    <p><strong>Recommendation:</strong> Risk communication efforts must focus equally on discouraging bat habitat interaction and reinforcing safe IPC practices among non-specialized healthcare staff.</p>
                `
            },
            "doc-moh-bat": {
                title: "Preliminary Findings on Bat Reservoir Monitoring in Oromia",
                source: "MoH Zoonotic Disease Surveillance Unit, 2025",
                content: `
                    <p><strong>Survey Result:</strong> Active surveillance in known *Rousettus* bat colonies has shown a stable but low prevalence of Marburg virus antibodies. The spillover event is likely related to human encroachment into specific, high-risk mining or caving areas rather than a widespread change in the bat population dynamics.</p>
                    <p><strong>Action:</strong> Implement temporary closure of specific caves/mines in the designated outbreak zone to reduce the risk of primary spillover.</p>
                `
            },
            "doc-global-vaccine": {
                title: "Phase 2 Trial Results of Investigational MVD Vaccine (The Lancet)",
                source: "The Lancet, International Vaccine Consortium",
                content: `
                    <p><strong>Results Summary:</strong> The leading candidate MVD vaccine (ChAd3-MVD) demonstrated an 85% seroconversion rate after a single dose in adult volunteers. The vaccine was well-tolerated, with mild to moderate adverse events reported. Full efficacy data requires Phase 3 trials.</p>
                    <p><strong>Deployment Implication:</strong> Results support the safety and immunogenicity necessary for a Ring Vaccination Strategy, should emergency deployment be approved by regulatory bodies.</p>
                `
            },
            "doc-global-mab": {
                title: "Efficacy of Monoclonal Antibody Treatment for Filoviruses (NEJM)",
                source: "New England Journal of Medicine (NEJM)",
                content: `
                    <p><strong>Treatment Efficacy:</strong> A triple monoclonal antibody (MAb) cocktail was found to significantly reduce mortality in non-human primate models challenged with Marburg virus. Early administration (within 48 hours of symptom onset) was critical for maximizing survival.</p>
                    <p><strong>Policy Note:</strong> The Ministry of Health must secure access to these investigational therapies under compassionate use or expanded access protocols for use in treatment centers.</p>
                `
            },
            "doc-global-rdt": {
                title: "Rapid Diagnostic Test Development for Marburg (Nature Microbiology)",
                source: "Nature Microbiology, Diagnostics Development Group",
                content: `
                    <p><strong>Innovation:</strong> A new lateral flow rapid diagnostic test (RDT) achieved 95% sensitivity and 98% specificity compared to gold-standard RT-PCR testing. This RDT is designed for use in resource-limited settings.</p>
                    <p><strong>Impact:</strong> Deployment of this RDT could drastically reduce diagnostic turnaround time in remote areas, enhancing patient isolation and contact tracing speed.</p>
                `
            }
        };


        // --- STATE MANAGEMENT AND DATA LOGIC ---
        // Initial state, reflecting the last input (13C, 8D, 4R, 1T, 888 Tests as of Dec 2)
        let currentOutbreakState = {
            totalConfirmedCases: 13,
            totalDeaths: 8,
            totalRecovered: 4,
            testsConducted: 888,
            on_treatment: 1, // Calculated from 13 - 8 - 4
        };
        const REPORT_DATE = new Date(2025, 11, 2, 17, 0, 0); // December 2, 2025

        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";
        const API_KEY = ""; // Placeholder for Canvas runtime environment

        /**
         * Fetches and calculates the outbreak data based on the current global state.
         */
        const getOutbreakData = () => {
            const { totalConfirmedCases, totalDeaths, totalRecovered, testsConducted } = currentOutbreakState;
            
            // Calculate active cases (On Treatment) based on core data integrity principle
            const calculatedOnTreatment = totalConfirmedCases - totalDeaths - totalRecovered;

            // Log error if data integrity is violated (but use the calculated value)
            if (calculatedOnTreatment !== currentOutbreakState.on_treatment) {
                 console.warn(`Data integrity error: Outcomes (D+R+T) do not match Confirmed Cases. Using calculated On Treatment: ${calculatedOnTreatment}.`);
            }
            
            // Use Math.max to ensure value is never negative in the report
            const finalOnTreatment = Math.max(0, calculatedOnTreatment);

            // Fixed secondary data
            const suspectedCases = 90; 
            const positiveCases = totalConfirmedCases; 
            const contactsMonitored = 500; 

            // --- DATA SOURCE LIST ---
            const dataSources = [
                "Official Website: moh.gov.et",
                "Twitter (X): x.com/fmohealth",
                "Ethiopian Public Health Institute (EPHI)"
            ];
            
            // Mock Data Discrepancy (Needed for report structure)
            const dataDiscrepancies = {
                case_range: `Unified Report: ${totalConfirmedCases}`, 
                death_range: `Unified Report: ${totalDeaths}`, 
            };

            // Function to replicate risk assessment logic
            const assessRiskLevel = (cases, fatalityRate, activeCases) => {
                if (activeCases === 0) return "Moderate"; // Contained cluster, historical high CFR is not active risk.
                if (cases === 0) return "Low";
                
                // Active cases > 0
                if (cases <= 15) return fatalityRate < 50 ? "High" : "Very High"; 
                if (cases <= 30) return "Very High";
                return "Critical";
            };

            const caseFatalityRate = ((totalDeaths / totalConfirmedCases) * 100).toFixed(1); 
            const testPositivityRate = ((positiveCases / testsConducted) * 100).toFixed(1); 
            const riskLevel = assessRiskLevel(totalConfirmedCases, parseFloat(caseFatalityRate), finalOnTreatment); 

            // Function to generate recommendations (replicates Python logic)
            const generateRecommendations = (riskLevel, cases) => {
                const recommendations = [
                    "Maintain intensive active and passive surveillance in affected regions.",
                    "Continue rigorous contact tracing and follow-up (42-day clock initiation).",
                    "Strengthen Infection Prevention and Control (IPC) protocols in all healthcare facilities."
                ];

                if (riskLevel === "Moderate") {
                     recommendations.push(
                        "Conduct targeted risk communication emphasizing community vigilance.",
                        "Maintain operational readiness of Isolation/Treatment Centers."
                    );
                } else if (["High", "Very High", "Critical"].includes(riskLevel)) {
                    recommendations.push(
                        "Activate national incident management system.",
                        "Mobilize national resources immediately.",
                        "Consider public gathering restrictions in hotspot areas."
                    );
                }
                
                return [...new Set(recommendations)];
            };

            // --- TRENDS AND FORECASTING SIMULATION ---
            const getDailyNewData = (refDate) => {
                // Simplified historical data for the last 7 days totaling current confirmed cases
                // Using 13 cases (0, 1, 2, 2, 3, 3, 2) and 8 deaths (0, 0, 1, 3, 2, 1, 1)
                const newCasesData = [0, 1, 2, 2, 3, 3, 2]; 
                const newDeathsData = [0, 0, 1, 3, 2, 1, 1]; 
                
                const finalNewData = newCasesData.map((cases, index) => ({
                    date: new Date(refDate.getTime() - (6 - index) * 24 * 60 * 60 * 1000),
                    newCases: cases,
                    newDeaths: newDeathsData[index]
                }));

                return finalNewData.map(day => ({
                    date: day.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                    newCases: day.newCases,
                    newDeaths: day.newDeaths
                }));
            };

            const dailyNewData = getDailyNewData(REPORT_DATE);

            const getCumulativeData = (newDailyData) => {
                let currentCumCases = 0;
                let currentCumDeaths = 0;
                
                const historyData = newDailyData.map((d, index) => {
                    currentCumCases += d.newCases;
                    currentCumDeaths += d.newDeaths;
                    
                    if (index === newDailyData.length - 1) {
                        // Ensure the final day matches the current total
                        currentCumCases = totalConfirmedCases; 
                        currentCumDeaths = totalDeaths; 
                    }

                    return {
                        date: d.date,
                        cumulativeCases: currentCumCases,
                        cumulativeDeaths: currentCumDeaths 
                    };
                });
                return historyData;
            };
            
            const cumulativeHistory = getCumulativeData(dailyNewData.map(d => ({
                date: d.date,
                newCases: d.newCases,
                newDeaths: d.newDeaths
            })));

            const generateForecast = (cumulativeHistory, activeCases) => {
                const forecastDays = 3;
                const forecast = [];
                
                const recentNewCases = dailyNewData.slice(-3).map(d => d.newCases);
                const avgCaseIncrease = recentNewCases.reduce((sum, val) => sum + val, 0) / recentNewCases.length; 
                
                let lastCaseCount = cumulativeHistory[cumulativeHistory.length - 1].cumulativeCases;
                let lastDeathCount = cumulativeHistory[cumulativeHistory.length - 1].cumulativeDeaths;

                for (let i = 1; i <= forecastDays; i++) {
                    const futureDate = new Date(REPORT_DATE.getTime() + i * 24 * 60 * 60 * 1000); 
                    
                    if (activeCases > 0) {
                        // Predict a small linear increase based on recent average
                        lastCaseCount += Math.round(avgCaseIncrease * 0.5); 
                        lastDeathCount += Math.round(avgCaseIncrease * (totalDeaths / totalConfirmedCases) * 0.5);
                    }
                    
                    forecast.push({
                        date: futureDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                        cumulativeCases: lastCaseCount,
                        cumulativeDeaths: lastDeathCount
                    });
                }
                return forecast;
            };

            const shortTermForecast = generateForecast(cumulativeHistory, finalOnTreatment);
            // --- END TRENDS AND FORECASTING SIMULATION ---

            const verifiedData = {
                confirmed_cases: totalConfirmedCases, 
                deaths: totalDeaths, 
                recovered_cases: totalRecovered,
                on_treatment: finalOnTreatment,
                suspected_cases: suspectedCases,
                tests_conducted: testsConducted,
                positive_cases: positiveCases,
                case_fatality_rate: parseFloat(caseFatalityRate),
                test_positivity_rate: parseFloat(testPositivityRate),
                contacts_monitored: contactsMonitored,
                risk_level: riskLevel,
                last_updated: REPORT_DATE.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }),
                data_sources: dataSources,
                data_discrepancies: dataDiscrepancies,
                recommendations: generateRecommendations(riskLevel, totalConfirmedCases),
                daily_new_data: dailyNewData, 
                cumulative_history: cumulativeHistory, 
                short_term_forecast: shortTermForecast 
            };

            const situationReport = {
                report_type: "Marburg Outbreak Situation Report - Ethiopia",
                generated_at: verifiedData.last_updated,
                executive_summary: `The Marburg Virus Disease (MVD) outbreak is currently assessed at a <b>${riskLevel.toUpperCase()}</b> risk level. Official figures from the Ministry of Health (as of December 2, 2025) confirm a total of <b>${verifiedData.confirmed_cases} Confirmed Cases</b>, with <b>${verifiedData.recovered_cases} Recovered</b> and <b>${verifiedData.deaths} Deaths</b>. Crucially, <b>${verifiedData.on_treatment} patient</b> is currently On Treatment, requiring immediate isolation and intensive care. The high Case Fatality Rate (CFR: ${caseFatalityRate}%) demands sustained intensive surveillance and strict adherence to Infection Prevention and Control (IPC) protocols to contain any further spread.`,
                key_metrics: verifiedData,
                status: finalOnTreatment > 0 ? "Active Surveillance & Response - High Alert" : "Outbreak Contained - Monitoring Period",
                alert_level: riskLevel,
            };

            return {
                verifiedData,
                situationReport
            };
        };


        // --- RENDERING LOGIC ---
        let forecastChartInstance = null;
        const ADMIN_PIN = "2025"; // The hardcoded secret PIN

        // Utility function to calculate the forecast end date (42 days after last active case)
        const calculateForecastEndDate = (activeCases, lastUpdateDate) => {
            // The 42-day clock starts ONLY when activeCases == 0
            if (activeCases > 0) {
                return "Containment Clock Not Started";
            }
            // If activeCases is 0, the clock starts from the date of the report (lastUpdateDate)
            const endDate = new Date(lastUpdateDate.getTime());
            endDate.setDate(endDate.getDate() + 42); 
            return endDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        };


        const renderDashboard = async () => {
            const { verifiedData: data } = getOutbreakData();

            const grid = document.getElementById('metric-grid');
            const riskStatus = document.getElementById('risk-status');

            const metrics = [{
                    label: "Confirmed Cases",
                    value: data.confirmed_cases,
                    icon: "üî•",
                    color: "text-red-700",
                    bg: "bg-red-100"
                },
                {
                    label: "Total Deaths",
                    value: data.deaths,
                    icon: "üíÄ",
                    color: "text-gray-700",
                    bg: "bg-gray-100"
                },
                {
                    label: "Recovered Patients",
                    value: data.recovered_cases,
                    icon: "‚úÖ",
                    color: "text-green-700",
                    bg: "bg-green-100"
                },
                {
                    label: "Patients On Treatment",
                    value: data.on_treatment,
                    icon: "üè•",
                    color: "text-blue-700",
                    bg: "bg-blue-100"
                },
                {
                    label: "Case Fatality Rate (CFR)",
                    value: `${data.case_fatality_rate}%`,
                    icon: "üìà",
                    color: "text-orange-700",
                    bg: "bg-orange-100"
                },
                {
                    label: "Contacts Monitored",
                    value: data.contacts_monitored,
                    icon: "üë•",
                    color: "text-blue-700",
                    bg: "bg-blue-100"
                },
                {
                    label: "Suspected Cases",
                    value: data.suspected_cases,
                    icon: "‚ö†Ô∏è",
                    color: "text-yellow-700",
                    bg: "bg-yellow-100"
                },
                {
                    label: "Total Tests Conducted",
                    value: data.tests_conducted,
                    icon: "üî¨",
                    color: "text-purple-700",
                    bg: "bg-purple-100"
                },
            ];

            grid.innerHTML = metrics.map(metric => `
                <div class="metric-card bg-white p-6 rounded-2xl shadow-lg border-b-4 border-transparent hover:border-gray-600">
                    <div class="flex items-center">
                        <div class="p-3 rounded-xl ${metric.bg} ${metric.color} text-xl mr-4">
                            ${metric.icon}
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">${metric.label}</p>
                            <p class="text-3xl font-extrabold text-gray-900">${metric.value}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            // Render Risk Status
            riskStatus.innerHTML = `
                <p class="text-sm font-semibold opacity-80">RISK LEVEL</p>
                <p class="text-3xl font-extrabold mt-1">${data.risk_level.toUpperCase()}</p>
            `;
            let riskClass = '';
            if (data.risk_level === 'Moderate') {
                riskClass = 'status-gradient-moderate';
            } else if (data.risk_level.includes('High') || data.risk_level === 'Critical') {
                riskClass = 'status-gradient-high animate-pulse-high';
            } else {
                riskClass = 'bg-gray-500'; 
            }

            riskStatus.className = `p-4 rounded-xl shadow-2xl text-center min-w-40 text-white ${riskClass}`;

            // Update hero date
            document.getElementById('last-updated-hero').textContent = `Last Consolidated Update: ${data.last_updated}`;
            
            // Render dependent sections
            const { situationReport } = getOutbreakData();
            renderAnalysis(data); 
            renderReport(situationReport, data);
            renderForecastEndPanel(data);

            // Update data entry form (ensure the form fields reflect the current data)
            document.getElementById('confirmed-cases').value = data.confirmed_cases;
            document.getElementById('tests-conducted').value = data.tests_conducted;
            document.getElementById('deaths').value = data.deaths;
            document.getElementById('recovered').value = data.recovered_cases;
            document.getElementById('on-treatment').value = data.on_treatment;

        };

        const renderReport = (report, data) => {
            document.getElementById('report-title').textContent = report.report_type;
            document.getElementById('report-status').textContent = `Status: ${report.status}`;
            document.getElementById('report-date').textContent = `Generated At: ${report.generated_at}`;
            document.getElementById('summary-content').innerHTML = report.executive_summary;

            // Key Figures
            const keyFigures = document.getElementById('key-figures');
            keyFigures.innerHTML = `
                <p><span class="font-bold">Confirmed Cases:</span> ${data.confirmed_cases} (Total)</p>
                <p><span class="font-bold">Total Deaths:</span> ${data.deaths}</p>
                <p><span class="font-bold">Recovered:</span> ${data.recovered_cases}</p>
                <p><span class="font-bold">On Treatment:</span> ${data.on_treatment}</p>
                <p><span class="font-bold">CFR:</span> ${data.case_fatality_rate}%</p>
                <p><span class="font-bold">Contacts Monitored:</span> ${data.contacts_monitored}</p>
                <p><span class="font-bold text-red-700">ALERT LEVEL:</span> ${data.risk_level.toUpperCase()}</p>
            `;

            // Recommendations
            const recommendationsList = document.getElementById('recommendations-list');
            recommendationsList.innerHTML = data.recommendations.map(rec => `<li>${rec}</li>`).join('');

            // Sources
            document.getElementById('sources-list').textContent = `Primary Data Sources: ${data.data_sources.join(', ')}.`;
        };

        const renderAnalysis = (data) => {
            // Render Daily New Data Table
            const trendsBody = document.getElementById('daily-trends-data');
            trendsBody.innerHTML = data.daily_new_data.map(day => {
                const caseColor = data.on_treatment > 0 ? 'text-red-700' : 'text-gray-700';

                return `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${day.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${caseColor} font-semibold">${day.newCases}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${day.newDeaths}</td>
                </tr>
            `}).join('');

            // --- Render Forecasting Chart ---
            const ctx = document.getElementById('forecastChart').getContext('2d');

            // 1. Prepare Data
            const allLabels = data.cumulative_history.map(d => d.date)
                .concat(data.short_term_forecast.map(d => d.date));
            const historyCaseData = data.cumulative_history.map(d => d.cumulativeCases);
            const forecastCaseData = data.short_term_forecast.map(d => d.cumulativeCases);
            const historyDeathData = data.cumulative_history.map(d => d.cumulativeDeaths);
            const forecastDeathData = data.short_term_forecast.map(d => d.cumulativeDeaths);

            const forecastPadding = new Array(historyCaseData.length - 1).fill(null);

            // 2. Destroy old chart instance if it exists
            if (forecastChartInstance) {
                forecastChartInstance.destroy();
            }

            // 3. Create new chart instance
            forecastChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: allLabels,
                    datasets: [
                        // Dataset 1: Confirmed Cases (Historical)
                        {
                            label: 'Confirmed Cases (Historical)',
                            data: historyCaseData.concat(null, null, null),
                            borderColor: 'rgb(239, 68, 68)', // Red
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.3,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            pointBackgroundColor: 'rgb(239, 68, 68)',
                            pointBorderColor: '#fff',
                            spanGaps: true 
                        },
                        {
                            label: 'Cases Forecast',
                            data: forecastPadding.concat(historyCaseData[historyCaseData.length - 1], forecastCaseData),
                            borderColor: 'rgba(239, 68, 68, 0.6)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: 'rgba(239, 68, 68, 0.6)',
                            pointBorderColor: '#fff',
                            spanGaps: true
                        },
                         // Dataset 3: Deaths (Historical)
                        {
                            label: 'Deaths (Historical)',
                            data: historyDeathData.concat(null, null, null),
                            borderColor: 'rgb(107, 114, 128)', // Gray
                            backgroundColor: 'rgba(107, 114, 128, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: 'rgb(107, 114, 128)',
                            pointBorderColor: '#fff',
                            spanGaps: true
                        },
                        {
                            label: 'Deaths Forecast',
                            data: forecastPadding.concat(historyDeathData[historyDeathData.length - 1], forecastDeathData),
                            borderColor: 'rgba(107, 114, 128, 0.6)',
                            borderWidth: 1.5,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.3,
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            pointBackgroundColor: 'rgba(107, 114, 128, 0.6)',
                            pointBorderColor: '#fff',
                            spanGaps: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: false,
                        },
                        legend: {
                            labels: {
                                font: {
                                    family: 'Inter',
                                },
                                filter: (legendItem, data) => {
                                    return legendItem.datasetIndex === 0 || legendItem.datasetIndex === 1 || legendItem.datasetIndex === 2 || legendItem.datasetIndex === 3;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cumulative Count',
                                font: {
                                    family: 'Inter',
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                }
            });
        };

        const renderForecastEndPanel = (data) => {
            const lastUpdateDate = new Date(REPORT_DATE.getTime());
            const forecastEndDate = calculateForecastEndDate(data.on_treatment, lastUpdateDate);

            document.getElementById('forecast-active-cases').textContent = data.on_treatment;
            document.getElementById('forecast-end-date').textContent = forecastEndDate;

            const endPanel = document.querySelector('#analysis .bg-red-50');
            
            if (data.on_treatment > 0) {
                // Active cases exist: HIGH ALERT
                endPanel.classList.add('bg-red-50', 'border-red-600');
                endPanel.classList.remove('bg-green-50', 'border-green-600');
            } else {
                 // Zero active cases: CONTAINMENT
                endPanel.classList.add('bg-green-50', 'border-green-600');
                endPanel.classList.remove('bg-red-50', 'border-red-600');
            }
        };


        // --- LLM GENERATION LOGIC ---

        const generateBulletin = async (data) => {
            const button = document.getElementById('generate-bulletin-btn');
            const outputDiv = document.getElementById('bulletin-output');
            const outputText = document.getElementById('bulletin-text');
            const outputError = document.getElementById('bulletin-error');
            const outputSources = document.getElementById('bulletin-sources');

            // Show loading state
            outputDiv.classList.remove('hidden');
            outputError.classList.add('hidden');
            button.disabled = true;
            button.textContent = 'Generating... Please wait.';
            outputText.innerHTML = '<div class="flex items-center space-x-2"><svg class="animate-spin h-5 w-5 text-red-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>Drafting Official Statement...</span></div>';
            outputSources.innerHTML = '';

            const systemPrompt = "Act as the official Spokesperson for the Ethiopia Ministry of Health. You must generate a concise, public-facing, single-paragraph statement (maximum 150 words) based on the provided outbreak data and integrate it with current general knowledge about Marburg Virus Disease (MVD). The tone must be authoritative, reassuring, and emphasize preventative actions. DO NOT mention data source discrepancies.";
            
            const userQuery = `Generate a Public Health Bulletin. The current situation in Ethiopia is:
- Confirmed Cases: ${data.confirmed_cases}
- Total Deaths: ${data.deaths}
- Case Fatality Rate (CFR): ${data.case_fatality_rate}%
- Recovered Cases: ${data.recovered_cases}
- Patients On Treatment: ${data.on_treatment}
- Risk Level: ${data.risk_level.toUpperCase()}
- Priority Actions: ${data.recommendations.slice(0, 3).join(', ')}.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(API_URL + API_KEY, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;
                    
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    outputText.textContent = text;
                    if (sources.length > 0) {
                        outputSources.innerHTML = `Grounded in external sources: ${sources.map(s => `<a href="${s.uri}" target="_blank" class="text-blue-600 hover:text-blue-800 underline">${s.title}</a>`).join(', ')}`;
                    } else {
                        outputSources.textContent = 'Grounded using Google Search, but no specific web source citation was returned.';
                    }

                } else {
                    outputText.textContent = "AI drafting failed. The model returned no text content.";
                    outputError.classList.remove('hidden');
                }

            } catch (e) {
                console.error("Gemini API Error:", e);
                outputText.textContent = "A critical error occurred while contacting the AI service.";
                outputError.classList.remove('hidden');
            } finally {
                // Reset button state
                button.disabled = false;
                button.textContent = 'Generate Public Bulletin Draft (via AI)';
            }
        };

        // --- DATA ENTRY AND FORM HANDLING ---

        const handleDataSubmission = (event) => {
            event.preventDefault();
            const messageElement = document.getElementById('data-entry-message');

            const newConfirmed = parseInt(document.getElementById('confirmed-cases').value) || 0;
            const newDeaths = parseInt(document.getElementById('deaths').value) || 0;
            const newRecovered = parseInt(document.getElementById('recovered').value) || 0;
            const newOnTreatment = parseInt(document.getElementById('on-treatment').value) || 0;
            const newTests = parseInt(document.getElementById('tests-conducted').value) || 0;

            const totalOutcomes = newDeaths + newRecovered + newOnTreatment;

            // 1. Data Integrity Check (Must hold true for official reports)
            if (newConfirmed !== totalOutcomes) {
                messageElement.textContent = `Error: Data integrity failed. Confirmed Cases (${newConfirmed}) must equal Deaths (${newDeaths}) + Recovered (${newRecovered}) + On Treatment (${newOnTreatment}). Please adjust figures.`;
                messageElement.classList.add('text-red-600');
                messageElement.classList.remove('text-green-600');
                return;
            }

            // 2. Update Global State
            currentOutbreakState = {
                totalConfirmedCases: newConfirmed,
                totalDeaths: newDeaths,
                totalRecovered: newRecovered,
                totalOnTreatment: newOnTreatment, 
                testsConducted: newTests,
            };

            // 3. Rerender Everything
            renderDashboard();

            // 4. Feedback
            messageElement.textContent = `Success! Data updated for ${newConfirmed} Confirmed Cases. All dashboards and reports refreshed.`;
            messageElement.classList.remove('text-red-600');
            messageElement.classList.add('text-green-600');
            window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top for user to see changes
        };

        // --- ADMIN PIN GATE ---

        const toggleDataEntryAccess = (loggedIn) => {
            const dataEntry = document.getElementById('data-entry');
            const adminButton = document.getElementById('admin-access-btn');
            const adminButtonMobile = document.getElementById('admin-access-btn-mobile');

            if (loggedIn) {
                dataEntry.classList.remove('hidden');
                adminButton.textContent = 'Log Out';
                adminButton.classList.add('bg-red-700', 'text-white');
                adminButton.classList.remove('bg-gray-200', 'text-gray-800');
                
                adminButtonMobile.textContent = 'Log Out';
                adminButtonMobile.classList.add('bg-red-700', 'text-white');
                adminButtonMobile.classList.remove('bg-gray-200', 'text-gray-800');
            } else {
                dataEntry.classList.add('hidden');
                adminButton.textContent = 'Admin Access';
                adminButton.classList.remove('bg-red-700', 'text-white');
                adminButton.classList.add('bg-gray-200', 'text-gray-800');

                adminButtonMobile.textContent = 'Admin Access';
                adminButtonMobile.classList.remove('bg-red-700', 'text-white');
                adminButtonMobile.classList.add('bg-gray-200', 'text-gray-800');
            }
        };

        const handlePinSubmission = (event) => {
            event.preventDefault();
            const pinInput = document.getElementById('pin-input');
            const pinMessage = document.getElementById('pin-message');

            if (pinInput.value === ADMIN_PIN) {
                document.getElementById('pin-modal').classList.remove('active');
                toggleDataEntryAccess(true);
                pinInput.value = ''; // Clear PIN
                pinMessage.classList.add('hidden');
            } else {
                pinMessage.classList.remove('hidden');
                pinInput.value = '';
                pinInput.focus();
            }
        };

        const handleAdminButtonClick = () => {
            const dataEntry = document.getElementById('data-entry');
            
            if (dataEntry.classList.contains('hidden')) {
                // Not logged in, show PIN modal
                document.getElementById('pin-modal').classList.add('active');
                document.getElementById('pin-message').classList.add('hidden');
                document.getElementById('pin-input').focus();
            } else {
                // Logged in, log out
                toggleDataEntryAccess(false);
            }
        };


        // --- INITIALIZATION ---

        const init = () => {
            try {
                // Set initial state from default data (ensures consistency)
                const initialData = getOutbreakData();
                currentOutbreakState = {
                    totalConfirmedCases: initialData.verifiedData.confirmed_cases,
                    totalDeaths: initialData.verifiedData.deaths,
                    totalRecovered: initialData.verifiedData.recovered_cases,
                    totalOnTreatment: initialData.verifiedData.on_treatment, 
                    testsConducted: initialData.verifiedData.tests_conducted,
                };
                
                renderDashboard();
                
                // Set current year in footer
                document.getElementById('year').textContent = new Date().getFullYear();

                // Mobile menu toggle
                document.getElementById('menu-button').addEventListener('click', () => {
                    document.getElementById('mobile-menu').classList.toggle('hidden');
                });

                // Admin gate listeners
                document.getElementById('admin-access-btn').addEventListener('click', handleAdminButtonClick);
                document.getElementById('admin-access-btn-mobile').addEventListener('click', handleAdminButtonClick);
                document.getElementById('pin-form').addEventListener('submit', handlePinSubmission);
                
                // Close modal on escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.getElementById('pin-modal').classList.remove('active');
                    }
                });


                // Form submission listener
                document.getElementById('update-data-form').addEventListener('submit', handleDataSubmission);

                // LLM button listener (only once)
                document.getElementById('generate-bulletin-btn').addEventListener('click', () => {
                     const { verifiedData: data } = getOutbreakData(); // Get latest data
                     generateBulletin(data);
                 });

                // Document viewer listeners
                document.querySelectorAll('.document-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const docId = e.target.getAttribute('data-doc-id');
                        const doc = MVD_DOCUMENTS[docId];
                        if (doc) {
                            document.getElementById('doc-title').textContent = doc.title;
                            document.getElementById('doc-source').textContent = doc.source;
                            document.getElementById('doc-content').innerHTML = doc.content;
                            document.getElementById('document-viewer').classList.add('active');
                        }
                    });
                });
                document.getElementById('close-viewer-btn').addEventListener('click', () => {
                    document.getElementById('document-viewer').classList.remove('active');
                });

            } catch (error) {
                console.error("Initialization Error:", error);
                document.getElementById('metric-grid').innerHTML = '<div class="col-span-4 p-8 bg-red-100 border border-red-400 rounded-xl text-red-800 font-bold text-center">Failed to load initial data. Check browser console for errors.</div>';
            }
        };

        window.onload = init;
    </script>
</body>
</html>
