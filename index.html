<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marburg Virus Disease Outbreak Monitoring - Ethiopia MoH</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <!-- Use Inter font family -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: 38 38 38;
            /* Deep Charcoal Black */
            --color-secondary: 245 245 245;
            /* Off-White/Light Gray for Contrast */
            --color-accent: 234 179 8;
            /* Gold/Yellow Accent */
            --color-alert: 239 68 68;
            /* Red for high risk */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfcfc;
        }

        /* Custom gradient for hero */
        .hero-gradient {
            /* Black to Dark Violet/Purple */
            background: linear-gradient(135deg, rgb(var(--color-primary)) 0%, #4c1d95 100%);
        }

        /* Gradient for status cards (Keeping Red for ALERT status) */
        .status-gradient-high {
            background: linear-gradient(135deg, rgb(var(--color-alert)) 0%, #b91c1c 100%);
            box-shadow: 0 10px 15px -3px rgba(var(--color-alert), 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .metric-card {
            transition: all 0.3s ease;
            transform: translateY(0);
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.1), 0 6px 10px -3px rgba(0, 0, 0, 0.05);
        }

        /* Custom scrollbar for aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: rgb(var(--color-primary));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #171717;
        }

        /* Animation for Risk Level pulse */
        @keyframes pulse-high {
            0%,
            100% {
                background-color: rgb(var(--color-alert));
            }

            50% {
                background-color: #f87171;
            }
        }

        .animate-pulse-high {
            animation: pulse-high 2s infinite;
        }
        
        /* New style for the moderate risk level */
        .status-gradient-moderate {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%); /* Green */
            box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>

<body>

    <!-- Navigation Bar -->
    <nav class="sticky top-0 z-50 bg-white shadow-lg backdrop-blur-sm bg-opacity-95">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logos and Title -->
                <div class="flex items-center space-x-3">
                    <!-- MOH Logo -->
                    <img src="https://placehold.co/40x40/B91C1C/FFFFFF?text=MoH" onerror="this.src='https://placehold.co/40x40/B91C1C/FFFFFF?text=MoH'" alt="Ethiopia MoH Logo" class="h-10 w-auto rounded-full shadow-md ring-1 ring-gray-200">
                    <!-- EPHI Logo -->
                    <img src="https://placehold.co/40x40/10B981/FFFFFF?text=EPHI" onerror="this.src='https://placehold.co/40x40/10B981/FFFFFF?text=EPHI'" alt="Ethiopia EPHI Logo" class="h-10 w-auto rounded-full shadow-md ring-1 ring-gray-200">
                    <a href="#" class="flex-shrink-0 flex items-center">
                        <span class="text-xl font-extrabold tracking-tight text-gray-800">Marburg Virus Monitoring System</span>
                    </a>
                </div>

                <div class="hidden md:flex space-x-8">
                    <a href="#dashboard" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Dashboard</a>
                    <a href="#analysis" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Data Analysis</a>
                    <a href="#about" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">About MVD</a>
                    <a href="#report" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Situation Report</a>
                    <a href="#bulletin" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Public Bulletin</a>
                    <a href="#resources" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Resources</a>
                    <a href="#research" class="text-gray-600 hover:text-red-700 transition duration-150 font-medium">Research</a>
                </div>
                <div class="md:hidden">
                    <button id="menu-button" class="text-gray-600 hover:text-red-700 focus:outline-none">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 flex flex-col">
                <a href="#dashboard" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Dashboard</a>
                <a href="#analysis" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Data Analysis</a>
                <a href="#about" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">About MVD</a>
                <a href="#report" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Situation Report</a>
                 <a href="#bulletin" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Public Bulletin</a>
                <a href="#resources" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Resources</a>
                <a href="#research" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-red-50">Research</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="hero-gradient py-20 sm:py-32 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl sm:text-6xl font-extrabold tracking-tight mb-4">
                Ethiopia Marburg Outbreak Monitoring
            </h1>
            <p class="text-xl sm:text-2xl font-medium text-white max-w-3xl mx-auto">
                Real-time data consolidation and situation reporting from the Ministry of Health.
            </p>
            <div class="mt-8 flex justify-center space-x-4">
                <!-- Changed button text color to black/gray-900 for contrast -->
                <a href="#dashboard" class="px-6 py-3 bg-white text-gray-900 font-bold rounded-xl shadow-lg hover:bg-gray-200 transition duration-300 transform hover:scale-105">
                    View Live Data
                </a>
                <a href="#report" class="px-6 py-3 border-2 border-white text-white font-semibold rounded-xl hover:bg-white hover:text-gray-900 transition duration-300 transform hover:scale-105">
                    Read Latest Report
                </a>
            </div>
            <p id="last-updated-hero" class="mt-6 text-sm opacity-70"></p>
        </div>
    </header>

    <!-- Dashboard Section -->
    <section id="dashboard" class="py-16 sm:py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                Outbreak Dashboard
            </h2>

            <!-- Key Metrics Grid -->
            <div id="metric-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Data will be populated here by JavaScript -->
            </div>
            <p id="dashboard-refresh-note" class="mt-4 text-center text-sm text-gray-500">
                Data refreshes automatically every 15 seconds (simulated live feed).
            </p>

            <!-- Risk Level & Action Status -->
            <div class="mt-16 bg-white p-8 rounded-2xl shadow-xl border-t-4 border-gray-700">
                <div class="flex flex-col lg:flex-row items-center justify-between">
                    <div class="mb-4 lg:mb-0">
                        <h3 class="text-2xl font-bold text-gray-800">Current Threat Assessment</h3>
                        <p class="text-gray-600">Consolidated risk level based on verified MoH data.</p>
                    </div>
                    <div id="risk-status" class="status-gradient-high text-white p-4 rounded-xl shadow-2xl text-center min-w-40 animate-pulse-high">
                        <p class="text-sm font-semibold opacity-80">RISK LEVEL</p>
                        <p class="text-3xl font-extrabold mt-1">HIGH</p>
                    </div>
                </div>
                <div id="data-note" class="mt-6 text-sm text-gray-500 border-t pt-4">
                    <p class="font-semibold text-gray-700 mb-1">Data Reconciliation Note:</p>
                    <p>All figures presented are derived exclusively from the Ministry of Health official website and public reports (moh.gov.et, x.com).</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Data Analysis Section (NEW) -->
    <section id="analysis" class="py-16 sm:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                Outbreak Data Analysis
            </h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

                <!-- Daily Trends (Table - showing NEW cases) -->
                <div class="p-8 rounded-2xl shadow-xl border border-gray-100 border-2 border-gray-200">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-3xl mr-3">üóìÔ∏è</span> Daily New Case Trends
                    </h3>
                    <p class="text-gray-600 mb-6">Confirmed *new* cases and deaths reported daily over the last 7 days.</p>
                    <div id="daily-trends-container" class="space-y-4 overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">New Cases</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">New Deaths</th>
                                </tr>
                            </thead>
                            <tbody id="daily-trends-data" class="bg-white divide-y divide-gray-200">
                                <!-- Data populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Short-Term Forecasting (Chart - showing CUMULATIVE cases/deaths) -->
                <div class="p-8 rounded-2xl shadow-xl border border-gray-100 bg-gray-50 border-2 border-gray-200">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-3xl mr-3">üîÆ</span> Cumulative Trend & Forecast
                    </h3>
                    <p class="text-gray-600 mb-6">Cumulative cases and deaths shown with a short-term projection (dashed line indicates forecast).</p>
                    <div id="forecasting-container" class="space-y-4">
                        <canvas id="forecastChart" class="w-full h-80"></canvas>
                    </div>
                    <p class="mt-8 text-sm text-gray-500 italic">This chart tracks the overall growth curve. The model estimate (dashed line) is based on simplified epidemiological principles and is subject to change.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Public Health Bulletin Section (NEW) -->
    <section id="bulletin" class="py-16 sm:py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                Public Health Bulletin (AI Generated Draft)
            </h2>
            <div class="bg-white p-8 rounded-2xl shadow-2xl border-t-4 border-gray-500">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-3xl mr-3">üó£Ô∏è</span> Official Statement Draft
                </h3>
                <p class="text-gray-600 mb-6">Generate a concise, authoritative public health communication based on the latest internal data and external Marburg context.</p>

                <button id="generate-bulletin-btn" class="w-full md:w-auto px-6 py-3 bg-gray-900 text-white font-bold rounded-xl shadow-lg hover:bg-gray-700 transition duration-300 transform hover:scale-[1.01]">
                    Generate Public Bulletin Draft (via AI)
                </button>

                <div id="bulletin-output" class="mt-8 p-6 bg-gray-100 rounded-xl border border-gray-200 hidden">
                    <p class="text-sm font-semibold text-gray-700 mb-3">MINISTRY OF HEALTH ETHIOPIA: OFFICIAL BULLETIN</p>
                    <div id="bulletin-text" class="text-gray-700 leading-relaxed">
                        <!-- Bulletin content or loading spinner will be inserted here -->
                    </div>
                    <div id="bulletin-sources" class="mt-4 text-xs text-gray-500">
                        <!-- Sources from Gemini API will be inserted here -->
                    </div>
                </div>

                <div id="bulletin-error" class="mt-8 p-4 bg-yellow-100 text-yellow-800 rounded-xl hidden">
                    Could not generate bulletin. Please check the API status or try again.
                </div>
            </div>
        </div>
    </section>
    
    <!-- Situation Report Section -->
    <section id="report" class="py-16 sm:py-24 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                SITUATION REPORT
            </h2>

            <div class="bg-white p-6 md:p-10 rounded-2xl shadow-2xl border border-gray-100">
                <div id="report-header" class="border-b pb-4 mb-6">
                    <p class="text-xs font-bold uppercase tracking-widest text-gray-600">Official Document</p>
                    <h3 id="report-title" class="text-3xl font-extrabold text-gray-800 mt-1"></h3>
                    <p id="report-status" class="mt-1 text-lg font-semibold text-gray-700"></p>
                    <p id="report-date" class="text-sm text-gray-500"></p>
                </div>

                <div id="executive-summary" class="mb-8">
                    <h4 class="text-xl font-bold text-gray-800 mb-3 border-l-4 border-gray-500 pl-3">Executive Summary</h4>
                    <p id="summary-content" class="text-gray-700 leading-relaxed whitespace-pre-line"></p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Section 1: Key Figures -->
                    <div class="lg:col-span-1">
                        <h4 class="text-xl font-bold text-gray-800 mb-3 border-l-4 border-gray-500 pl-3">Key Outbreak Figures</h4>
                        <div id="key-figures" class="space-y-3 p-4 bg-gray-50 rounded-xl">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Section 2: Response & Recommendations -->
                    <div class="lg:col-span-2">
                        <h4 class="text-xl font-bold text-gray-800 mb-3 border-l-4 border-gray-500 pl-3">Immediate Actions & Recommendations</h4>
                        <ul id="recommendations-list" class="space-y-2 text-gray-700 list-disc pl-5">
                            <!-- Populated by JS -->
                        </ul>
                        <p class="mt-6 text-sm italic text-gray-600">These actions are prioritized by the National Incident Management System based on the current risk assessment.</p>
                    </div>
                </div>

                <div class="mt-10 pt-6 border-t">
                    <h4 class="text-xl font-bold text-gray-800 mb-3 border-l-4 border-gray-500 pl-3">Sources of Data</h4>
                    <p id="sources-list" class="text-sm text-gray-600 leading-relaxed">
                        <!-- Populated by JS -->
                    </p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Research and New Findings Section (NEW) -->
    <section id="research" class="py-16 sm:py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                Research & New Findings
            </h2>
            <p class="text-lg text-gray-600 text-center mb-10 max-w-3xl mx-auto">
                Access the latest peer-reviewed research and scientific updates relevant to Marburg Virus Disease epidemiology, diagnostics, and therapeutics.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Ethiopian Research -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-700">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">üá™üáπ</span> National & Regional Research
                    </h3>
                    <ul class="space-y-3">
                        <li>
                            <a href="https://ephi.gov.et/mvd-genomic-sequencing-mock" target="_blank" class="font-medium text-red-700 hover:text-red-900 transition underline">
                                Genomic Sequencing of Ethiopian MVD Strains (EPHI Report)
                            </a>
                            <p class="text-sm text-gray-600">Analysis of the current circulating virus strains for mutation detection.</p>
                        </li>
                        <li>
                            <a href="https://aau.edu.et/public-health-journal-mock" target="_blank" class="font-medium text-red-700 hover:text-red-900 transition underline">
                                Socio-Demographic Risk Factors in Southern Ethiopia MVD Outbreak
                            </a>
                            <p class="text-sm text-gray-600">Addis Ababa University (AAU) study on community transmission drivers.</p>
                        </li>
                        <li>
                            <a href="https://moh.gov.et/bat-reservoir-study-mock" target="_blank" class="font-medium text-red-700 hover:text-red-900 transition underline">
                                Preliminary Findings on Bat Reservoir Monitoring in Oromia
                            </a>
                            <p class="text-sm text-gray-600">Ecological survey identifying potential zoonotic spillover points.</p>
                        </li>
                    </ul>
                </div>

                <!-- Global Research -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-700">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">üåç</span> Global Scientific Updates
                    </h3>
                    <ul class="space-y-3">
                        <li>
                            <a href="https://www.thelancet.com/mvd-vaccine-trial-mock" target="_blank" class="font-medium text-blue-700 hover:text-blue-900 transition underline">
                                Phase 2 Trial Results of Investigational MVD Vaccine (The Lancet)
                            </a>
                            <p class="text-sm text-gray-600">Clinical efficacy and safety data for leading vaccine candidates.</p>
                        </li>
                        <li>
                            <a href="https://www.nejm.org/mvd-monoclonal-mock" target="_blank" class="font-medium text-blue-700 hover:text-blue-900 transition underline">
                                Efficacy of Monoclonal Antibody Treatment for Filoviruses (NEJM)
                            </a>
                            <p class="text-sm text-gray-600">New England Journal of Medicine analysis on antiviral therapies.</p>
                        </li>
                        <li>
                            <a href="https://www.nature.com/mvd-diagnostic-mock" target="_blank" class="font-medium text-blue-700 hover:text-blue-900 transition underline">
                                Rapid Diagnostic Test Development for Marburg (Nature Microbiology)
                            </a>
                            <p class="text-sm text-gray-600">Advancements in point-of-care diagnostics for immediate testing.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>


    <!-- Resources and Documents Section -->
    <section id="resources" class="py-16 sm:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
                Official Documents & Resources
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Ethiopia National Documents -->
                <div class="bg-gray-50 p-6 rounded-xl shadow-lg border-l-4 border-red-700">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">üá™üáπ</span> National Guidelines
                    </h3>
                    <ul class="space-y-3">
                        <li>
                            <a href="https://moh.gov.et/mvd-nims-plan-mock" target="_blank" class="font-medium text-red-700 hover:text-red-900 transition underline">
                                Ethiopia MVD National Incident Management Plan (Latest)
                            </a>
                            <p class="text-sm text-gray-600">MoH/EPHI joint policy on outbreak response and coordination.</p>
                        </li>
                        <li>
                            <a href="https://moh.gov.et/ipc-guidance-mock" target="_blank" class="font-medium text-red-700 hover:text-red-900 transition underline">
                                Infection Prevention Control (IPC) Guidelines for MVD
                            </a>
                            <p class="text-sm text-gray-600">Specific protocols for healthcare workers and burial teams.</p>
                        </li>
                        <li>
                            <a href="https://moh.gov.et/risk-communication-mock" target="_blank" class="font-medium text-red-700 hover:text-red-900 transition underline">
                                Community Risk Communication Strategy - Amharic (PDF)
                            </a>
                            <p class="text-sm text-gray-600">Official material for public awareness and messaging.</p>
                        </li>
                    </ul>
                </div>

                <!-- Global and International Documents -->
                <div class="bg-gray-50 p-6 rounded-xl shadow-lg border-l-4 border-blue-700">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">üåç</span> Global & International Standards
                    </h3>
                    <ul class="space-y-3">
                        <li>
                            <a href="https://www.who.int/emergencies/disease-outbreak-news-mvd-mock" target="_blank" class="font-medium text-blue-700 hover:text-blue-900 transition underline">
                                WHO Marburg Fact Sheet and Q&A
                            </a>
                            <p class="text-sm text-gray-600">Up-to-date global information on the virus and its control.</p>
                        </li>
                        <li>
                            <a href="https://www.cdc.gov/vhf/marburg/treatment-mock" target="_blank" class="font-medium text-blue-700 hover:text-blue-900 transition underline">
                                CDC Clinical Guidance for MVD Case Management
                            </a>
                            <p class="text-sm text-gray-600">Best practices for treating symptomatic patients and supportive care.</p>
                        </li>
                        <li>
                            <a href="https://www.who.int/ihr/2005/mock" target="_blank" class="font-medium text-blue-700 hover:text-blue-900 transition underline">
                                International Health Regulations (IHR) 2005 Framework
                            </a>
                            <p class="text-sm text-gray-600">Mandatory framework for reporting and responding to severe public health events.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- About Marburg Section -->
    <section id="about" class="py-16 sm:py-24 bg-gray-800 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-center mb-12">
                About Marburg Virus Disease (MVD)
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Card 1: Symptoms -->
                <div class="bg-gray-700 bg-opacity-70 p-6 rounded-xl shadow-xl border-l-4 border-yellow-400">
                    <div class="text-3xl mb-3">ü§ï</div>
                    <h3 class="text-xl font-semibold mb-3">Symptoms & Onset</h3>
                    <p class="text-sm opacity-90">MVD is a severe, often fatal hemorrhagic fever. Initial symptoms (abrupt high fever, severe headache, malaise) begin 2 to 21 days after infection. Later symptoms include severe watery diarrhea, abdominal pain, nausea, and vomiting. Bleeding manifestations may occur 5 to 7 days into the illness.</p>
                </div>
                <!-- Card 2: Transmission -->
                <div class="bg-gray-700 bg-opacity-70 p-6 rounded-xl shadow-xl border-l-4 border-yellow-400">
                    <div class="text-3xl mb-3">ü¶á</div>
                    <h3 class="text-xl font-semibold mb-3">Transmission Pathways</h3>
                    <p class="text-sm opacity-90">The reservoir host is the African fruit bat (*Rousettus aegyptiacus*). Human-to-human transmission occurs through direct contact with blood, secretions, organs, or other body fluids of infected people, and surfaces and materials contaminated with these fluids. </p>
                </div>
                <!-- Card 3: Prevention & Control -->
                <div class="bg-gray-700 bg-opacity-70 p-6 rounded-xl shadow-xl border-l-4 border-yellow-400">
                    <div class="text-3xl mb-3">üßº</div>
                    <h3 class="text-xl font-semibold mb-3">Key Prevention Measures</h3>
                    <p class="text-sm opacity-90">Prevention focuses on reducing the risk of bat-to-human transmission (avoiding fruit bats/caves) and limiting human-to-human spread (safe burials, contact tracing, infection prevention and control (IPC) practices in healthcare settings, and community awareness).</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact & Footer -->
    <footer id="contact" class="bg-gray-800 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h4 class="text-lg font-bold mb-3 text-yellow-400">Ethiopia Ministry of Health (MoH)</h4>
                    <p class="text-sm text-gray-400">
                        Dedicated to protecting the health and well-being of the Ethiopian people through preparedness, surveillance, and response.
                    </p>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-3 text-yellow-400">Quick Links</h4>
                    <ul class="space-y-1 text-sm">
                        <li><a href="#dashboard" class="text-gray-300 hover:text-white transition">Dashboard</a></li>
                        <li><a href="#analysis" class="text-gray-300 hover:text-white transition">Data Analysis</a></li>
                        <li><a href="#about" class="text-gray-300 hover:text-white transition">About MVD</a></li>
                        <li><a href="#report" class="text-gray-300 hover:text-white transition">Situation Report</a></li>
                        <li><a href="#bulletin" class="text-gray-300 hover:text-white transition">Public Bulletin</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-3 text-yellow-400">Contact IPC Team</h4>
                    <p class="text-sm text-gray-400">
                        Public Health Emergency Operations Center (PHEOC)<br>
                        Email: pheoc@moh.gov.et (Mock Address)<br>
                        Hotline: 8383 (National Mock Line)
                    </p>
                </div>
            </div>
            <div class="mt-10 border-t border-gray-700 pt-6 text-center">
                <p class="text-sm text-gray-500">&copy; <span id="year"></span> Ethiopia Ministry of Health. All Rights Reserved. Data for demonstration purposes.</p>
            </div>
        </div>
    </footer>

    <script>
        // --- DATA LOGIC (Replicating Python `MarburgOutbreakMonitor` calculations) ---
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";
        const API_KEY = ""; // Placeholder for Canvas runtime environment

        /**
         * Generates the simulated outbreak data and situation report based on the provided Python logic.
         */
        const getOutbreakData = (isLive = false) => {
            // --- SET REPORT DATE TO DECEMBER 2, 2025 (BASE DATE) ---
            // Month is 0-indexed: 11 is December
            const baseDate = new Date(2025, 11, 2, 17, 0, 0); 
            
            // --- UPDATED SIMULATED MOH CONSOLIDATED DATA INPUTS (As of Dec 2, 2025) ---
            let totalConfirmedCases = 13; 
            let totalDeaths = 8;        
            let totalRecovered = 4;     
            let testsConducted = 888;   
            
            // SIMULATE LIVE DATA DRIFT (if called via setInterval)
            if (isLive) {
                // Introduce slight, non-breaking drift in active cases and tests over time
                const drift = Math.floor(Math.random() * 2) - 1; // -1, 0, or 1
                
                // Active cases (On Treatment) might fluctuate, but must be >= 0
                let activeCases = totalConfirmedCases - totalDeaths - totalRecovered; // Starts at 1
                
                // If active cases are currently 0, only drift upwards (new case) or stay at 0
                if (activeCases === 0) {
                    const newCase = Math.random() < 0.1 ? 1 : 0; // 10% chance of a new case
                    activeCases = newCase;
                } else {
                    activeCases = Math.max(0, activeCases + drift); 
                }
                
                // Re-calculate Total Confirmed Cases to reflect the drift in active cases
                totalConfirmedCases = totalDeaths + totalRecovered + activeCases;
                testsConducted = 888 + Math.floor(Math.random() * 5); // Tests slightly increase

                // Update the report date to the current time for live update timestamp
                baseDate.setTime(Date.now());
            }

            const referenceDate = baseDate;
            const totalOnTreatment = totalConfirmedCases - totalDeaths - totalRecovered; // Should be 1 initially

            // Fixed secondary data
            const suspectedCases = 90; // Kept fixed, representing total investigated individuals
            const positiveCases = totalConfirmedCases; 
            const contactsMonitored = 500; 

            // --- DATA SOURCE LIST UPDATED ---
            const dataSources = [
                "Official Website: moh.gov.et",
                "Twitter (X): x.com/fmohealth",
                "Ethiopian Public Health Institute (EPHI)" // Keeping EPHI as a source for comprehensive reporting
            ];
            
            // Data Discrepancy is now irrelevant with single source
            const dataDiscrepancies = {
                case_range: `Unified MoH/EPHI Report: ${totalConfirmedCases}`, 
                death_range: `Unified MoH/EPHI Report: ${totalDeaths}`, 
            };

            // Function to replicate risk assessment logic
            const assessRiskLevel = (cases, fatalityRate, activeCases) => {
                if (activeCases === 0 && cases > 0) return "Moderate"; // Contained cluster, high CFR is historical risk.
                if (cases === 0) return "Low";
                // 1 active case, high CFR means risk remains heightened
                if (cases <= 15) return fatalityRate < 50 ? "Moderate" : "High"; 
                if (cases <= 30) return "High";
                return "Critical";
            };

            const caseFatalityRate = ((totalDeaths / totalConfirmedCases) * 100).toFixed(1); 
            const testPositivityRate = ((positiveCases / testsConducted) * 100).toFixed(1); // 1.5%
            const riskLevel = assessRiskLevel(totalConfirmedCases, parseFloat(caseFatalityRate), totalOnTreatment); // Calculated as "High" (1 active case)

            // Function to generate recommendations (replicates Python logic)
            const generateRecommendations = (riskLevel, cases) => {
                const recommendations = [
                    "Maintain intensive active and passive surveillance in affected regions.",
                    "Continue rigorous contact tracing and follow-up (42-day clock initiation).",
                    "Strengthen Infection Prevention and Control (IPC) protocols in all healthcare facilities."
                ];

                if (riskLevel === "Moderate") {
                     recommendations.push(
                        "Conduct targeted risk communication emphasizing community vigilance.",
                        "Maintain operational readiness of Isolation/Treatment Centers."
                    );
                } else if (["High", "Critical"].includes(riskLevel)) {
                    recommendations.push(
                        "Activate national incident management system.",
                        "Mobilize national resources immediately.",
                        "Consider public gathering restrictions in hotspot areas."
                    );
                }
                
                // Return unique recommendations only
                return [...new Set(recommendations)];
            };

            // --- TRENDS AND FORECASTING SIMULATION (Using base case count) ---
            const getDailyNewData = (refDate) => {
                // Data for the last 7 days totaling 13 cases and 8 deaths
                const newCasesData = [0, 1, 2, 2, 3, 3, 2]; 
                const newDeathsData = [0, 0, 1, 3, 2, 1, 1]; 
                
                const finalNewData = newCasesData.map((cases, index) => ({
                    date: new Date(refDate.getTime() - (6 - index) * 24 * 60 * 60 * 1000),
                    newCases: cases,
                    newDeaths: newDeathsData[index]
                }));

                return finalNewData.map(day => ({
                    date: day.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                    newCases: day.newCases,
                    newDeaths: day.newDeaths
                }));
            };

            const dailyNewData = getDailyNewData(baseDate);

            const getCumulativeData = (newDailyData) => {
                let currentCumCases = 0;
                let currentCumDeaths = 0;
                
                // Adjust the last cumulative entry to match the potentially 'live' totalConfirmedCases
                const historyData = newDailyData.map((d, index) => {
                    currentCumCases += d.newCases;
                    currentCumDeaths += d.newDeaths;
                    
                    if (index === newDailyData.length - 1) {
                         // Apply the totalConfirmedCases to the final day of history
                        currentCumCases = totalConfirmedCases; 
                    }

                    return {
                        date: d.date,
                        cumulativeCases: currentCumCases,
                        cumulativeDeaths: currentCumDeaths 
                    };
                });
                return historyData;
            };
            
            const cumulativeHistory = getCumulativeData(dailyNewData.map(d => ({
                date: d.date,
                newCases: d.newCases,
                newDeaths: d.newDeaths
            })));

            const generateForecast = (cumulativeHistory) => {
                const forecastDays = 3;
                const forecast = [];
                
                // Simple average increase over last 3 days for trend
                const recentNewCases = dailyNewData.slice(-3).map(d => d.newCases);
                const recentNewDeaths = dailyNewData.slice(-3).map(d => d.newDeaths);
                
                const avgCaseIncrease = recentNewCases.reduce((sum, val) => sum + val, 0) / recentNewCases.length; 
                const avgDeathIncrease = recentNewDeaths.reduce((sum, val) => sum + val, 0) / recentNewDeaths.length; 
                
                // Forecast starts from the end of the historical period (current data point)
                let lastCaseCount = cumulativeHistory[cumulativeHistory.length - 1].cumulativeCases;
                let lastDeathCount = cumulativeHistory[cumulativeHistory.length - 1].cumulativeDeaths;

                for (let i = 1; i <= forecastDays; i++) {
                    const futureDate = new Date(referenceDate.getTime() + i * 24 * 60 * 60 * 1000); 
                    
                    // Since active cases is 1, forecast minimal continued growth
                    lastCaseCount += (totalOnTreatment > 0 ? Math.round(avgCaseIncrease * 1.05) : 0); 
                    lastDeathCount += (totalOnTreatment > 0 ? Math.round(avgCaseIncrease * (totalDeaths / totalConfirmedCases) * 1.05) : 0);
                    
                    forecast.push({
                        date: futureDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                        cumulativeCases: lastCaseCount,
                        cumulativeDeaths: lastDeathCount
                    });
                }
                return forecast;
            };

            const shortTermForecast = generateForecast(cumulativeHistory);

            // --- END TRENDS AND FORECASTING SIMULATION ---

            const verifiedData = {
                confirmed_cases: totalConfirmedCases, 
                deaths: totalDeaths, 
                recovered_cases: totalRecovered,
                on_treatment: totalOnTreatment,
                suspected_cases: suspectedCases,
                tests_conducted: testsConducted,
                positive_cases: positiveCases,
                case_fatality_rate: parseFloat(caseFatalityRate),
                test_positivity_rate: parseFloat(testPositivityRate),
                contacts_monitored: contactsMonitored,
                risk_level: riskLevel,
                last_updated: referenceDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }),
                data_sources: dataSources,
                data_discrepancies: dataDiscrepancies,
                recommendations: generateRecommendations(riskLevel, totalConfirmedCases),
                daily_new_data: dailyNewData, // Used for the table
                cumulative_history: cumulativeHistory, // Used for the chart
                short_term_forecast: shortTermForecast // Used for the chart
            };

            const situationReport = {
                report_type: "Marburg Outbreak Situation Report - Ethiopia",
                generated_at: verifiedData.last_updated,
                executive_summary: `The Marburg Virus Disease (MVD) outbreak is currently assessed at a <b>${riskLevel.toUpperCase()}</b> risk level. Official figures from the Ministry of Health (as of December 2, 2025) confirm a total of <b>${verifiedData.confirmed_cases} Confirmed Cases</b>, with <b>${verifiedData.recovered_cases} Recovered</b> and <b>${verifiedData.deaths} Deaths</b>. Crucially, <b>${verifiedData.on_treatment} patient</b> is currently On Treatment, requiring immediate isolation and intensive care. The high Case Fatality Rate (CFR: ${caseFatalityRate}%) demands sustained intensive surveillance and strict adherence to Infection Prevention and Control (IPC) protocols to contain any further spread.`,
                key_metrics: verifiedData,
                status: "Active Surveillance & Response - High Alert",
                alert_level: riskLevel,
            };

            return {
                verifiedData,
                situationReport
            };
        };

        // Simulates async fetch (100ms delay)
        const fetchOutbreakData = (isLive = false) => {
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(getOutbreakData(isLive));
                }, 100);
            });
        };

        // --- RENDERING LOGIC ---

        // Global Chart Instance
        let forecastChartInstance = null;

        const renderDashboard = async (isLive = false) => {
            const { verifiedData: data } = await fetchOutbreakData(isLive);

            const grid = document.getElementById('metric-grid');
            const riskStatus = document.getElementById('risk-status');
            const note = document.getElementById('data-note');

            const metrics = [{
                    label: "Confirmed Cases",
                    value: data.confirmed_cases,
                    icon: "üî•",
                    color: "text-red-700",
                    bg: "bg-red-100"
                },
                {
                    label: "Deaths Reported",
                    value: data.deaths,
                    icon: "üíÄ",
                    color: "text-gray-700",
                    bg: "bg-gray-100"
                },
                {
                    label: "Recovered Patients",
                    value: data.recovered_cases,
                    icon: "‚úÖ",
                    color: "text-green-700",
                    bg: "bg-green-100"
                },
                {
                    label: "Patients On Treatment",
                    value: data.on_treatment,
                    icon: "üè•",
                    color: "text-blue-700",
                    bg: "bg-blue-100"
                },
                {
                    label: "Case Fatality Rate (CFR)",
                    value: `${data.case_fatality_rate}%`,
                    icon: "üìà",
                    color: "text-orange-700",
                    bg: "bg-orange-100"
                },
                {
                    label: "Contacts Monitored",
                    value: data.contacts_monitored,
                    icon: "üë•",
                    color: "text-blue-700",
                    bg: "bg-blue-100"
                },
                {
                    label: "Suspected Cases",
                    value: data.suspected_cases,
                    icon: "‚ö†Ô∏è",
                    color: "text-yellow-700",
                    bg: "bg-yellow-100"
                },
                {
                    label: "Tests Conducted", // Changed label for clarity
                    value: data.tests_conducted,
                    icon: "üî¨",
                    color: "text-purple-700",
                    bg: "bg-purple-100"
                },
            ];

            grid.innerHTML = metrics.map(metric => `
                <div class="metric-card bg-white p-6 rounded-2xl shadow-lg border-b-4 border-transparent hover:border-gray-600">
                    <div class="flex items-center">
                        <div class="p-3 rounded-xl ${metric.bg} ${metric.color} text-xl mr-4">
                            ${metric.icon}
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">${metric.label}</p>
                            <p class="text-3xl font-extrabold text-gray-900">${metric.value}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            // Render Risk Status
            riskStatus.innerHTML = `
                <p class="text-sm font-semibold opacity-80">RISK LEVEL</p>
                <p class="text-3xl font-extrabold mt-1">${data.risk_level.toUpperCase()}</p>
            `;
            // Determine the risk status class based on the calculated risk level
            let riskClass = '';
            if (data.risk_level === 'Moderate') {
                riskClass = 'status-gradient-moderate';
            } else if (data.risk_level.includes('High') || data.risk_level === 'Critical') {
                riskClass = 'status-gradient-high animate-pulse-high';
            } else {
                riskClass = 'bg-gray-500'; // Default for Low
            }

            riskStatus.className = `p-4 rounded-xl shadow-2xl text-center min-w-40 text-white ${riskClass}`;

            // Update the data note
            const dataNoteParagraph = note.querySelector('p:last-child');
            dataNoteParagraph.textContent = `All figures presented are derived exclusively from the Ministry of Health official website and public reports (moh.gov.et, x.com).`;


            // Update hero date
            document.getElementById('last-updated-hero').textContent = `Last Consolidated Update: ${data.last_updated}`;
            
            // Only update the Analysis and Report on the initial load, not every 15 seconds.
            if (!isLive) {
                 const { situationReport } = await fetchOutbreakData(isLive);
                 renderAnalysis(data); 
                 renderReport(situationReport, data);

                 // Setup LLM button listener (only once)
                 document.getElementById('generate-bulletin-btn').addEventListener('click', () => {
                     generateBulletin(data);
                 });
            }
        };

        const renderReport = (report, data) => {
            document.getElementById('report-title').textContent = report.report_type;
            document.getElementById('report-status').textContent = `Status: ${report.status}`;
            document.getElementById('report-date').textContent = `Generated At: ${report.generated_at}`;
            document.getElementById('summary-content').innerHTML = report.executive_summary;

            // Key Figures
            const keyFigures = document.getElementById('key-figures');
            keyFigures.innerHTML = `
                <p><span class="font-bold">Confirmed Cases:</span> ${data.confirmed_cases} (Total)</p>
                <p><span class="font-bold">Total Deaths:</span> ${data.deaths}</p>
                <p><span class="font-bold">Recovered:</span> ${data.recovered_cases}</p>
                <p><span class="font-bold">On Treatment:</span> ${data.on_treatment}</p>
                <p><span class="font-bold">CFR:</span> ${data.case_fatality_rate}%</p>
                <p><span class="font-bold">Contacts Monitored:</span> ${data.contacts_monitored}</p>
                <p><span class="font-bold text-red-700">ALERT LEVEL:</span> ${data.risk_level.toUpperCase()}</p>
            `;

            // Recommendations
            const recommendationsList = document.getElementById('recommendations-list');
            recommendationsList.innerHTML = data.recommendations.map(rec => `<li>${rec}</li>`).join('');

            // Sources
            document.getElementById('sources-list').textContent = `Primary Data Sources: ${data.data_sources.join(', ')}.`;
        };

        const renderAnalysis = (data) => {
            // Render Daily New Data Table
            const trendsBody = document.getElementById('daily-trends-data');
            trendsBody.innerHTML = data.daily_new_data.map(day => {
                // Determine coloring for the new data table based on active cases
                const caseColor = data.on_treatment > 0 ? 'text-red-700' : 'text-gray-700';

                return `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${day.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${caseColor} font-semibold">${day.newCases}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${day.newDeaths}</td>
                </tr>
            `}).join('');

            // --- Render Forecasting Chart ---
            const ctx = document.getElementById('forecastChart').getContext('2d');

            // 1. Prepare Data
            const allLabels = data.cumulative_history.map(d => d.date)
                .concat(data.short_term_forecast.map(d => d.date));
            const historyCaseData = data.cumulative_history.map(d => d.cumulativeCases);
            const forecastCaseData = data.short_term_forecast.map(d => d.cumulativeCases);
            const historyDeathData = data.cumulative_history.map(d => d.cumulativeDeaths);
            const forecastDeathData = data.short_term_forecast.map(d => d.cumulativeDeaths);

            // Create null-filled data for the historical segment of the forecast line
            const forecastPadding = new Array(historyCaseData.length - 1).fill(null);

            // 2. Destroy old chart instance if it exists
            if (forecastChartInstance) {
                forecastChartInstance.destroy();
            }

            // 3. Create new chart instance
            forecastChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: allLabels,
                    datasets: [
                        // Dataset 1: Confirmed Cases (Historical)
                        {
                            label: 'Confirmed Cases (Historical)',
                            data: historyCaseData.concat(null, null, null),
                            borderColor: 'rgb(239, 68, 68)', // Red
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.3,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            pointBackgroundColor: 'rgb(239, 68, 68)',
                            pointBorderColor: '#fff',
                            spanGaps: true // Crucial for forecast padding
                        },
                        {
                            label: 'Cases Forecast',
                            data: forecastPadding.concat(historyCaseData[historyCaseData.length - 1], forecastCaseData),
                            borderColor: 'rgba(239, 68, 68, 0.6)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: 'rgba(239, 68, 68, 0.6)',
                            pointBorderColor: '#fff',
                            spanGaps: true
                        },
                         // Dataset 3: Deaths (Historical)
                        {
                            label: 'Deaths (Historical)',
                            data: historyDeathData.concat(null, null, null),
                            borderColor: 'rgb(107, 114, 128)', // Gray
                            backgroundColor: 'rgba(107, 114, 128, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: 'rgb(107, 114, 128)',
                            pointBorderColor: '#fff',
                            spanGaps: true
                        },
                        {
                            label: 'Deaths Forecast',
                            data: forecastPadding.concat(historyDeathData[historyDeathData.length - 1], forecastDeathData),
                            borderColor: 'rgba(107, 114, 128, 0.6)',
                            borderWidth: 1.5,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.3,
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            pointBackgroundColor: 'rgba(107, 114, 128, 0.6)',
                            pointBorderColor: '#fff',
                            spanGaps: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: false,
                        },
                        legend: {
                            labels: {
                                font: {
                                    family: 'Inter',
                                },
                                // Filter out redundant historical/forecast labels in the legend
                                filter: (legendItem, data) => {
                                    return legendItem.datasetIndex === 0 || legendItem.datasetIndex === 1 || legendItem.datasetIndex === 2 || legendItem.datasetIndex === 3;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cumulative Count',
                                font: {
                                    family: 'Inter',
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                }
            });
        };


        // --- LLM GENERATION LOGIC ---

        const generateBulletin = async (data) => {
            const button = document.getElementById('generate-bulletin-btn');
            const outputDiv = document.getElementById('bulletin-output');
            const outputText = document.getElementById('bulletin-text');
            const outputError = document.getElementById('bulletin-error');
            const outputSources = document.getElementById('bulletin-sources');

            // Show loading state
            outputDiv.classList.remove('hidden');
            outputError.classList.add('hidden');
            button.disabled = true;
            button.textContent = 'Generating... Please wait.';
            outputText.innerHTML = '<div class="flex items-center space-x-2"><svg class="animate-spin h-5 w-5 text-red-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>Drafting Official Statement...</span></div>';
            outputSources.innerHTML = '';

            const systemPrompt = "Act as the official Spokesperson for the Ethiopia Ministry of Health. You must generate a concise, public-facing, single-paragraph statement (maximum 150 words) based on the provided outbreak data and integrate it with current general knowledge about Marburg Virus Disease (MVD). The tone must be authoritative, reassuring, and emphasize preventative actions. DO NOT mention data source discrepancies.";
            
            const userQuery = `Generate a Public Health Bulletin. The current situation in Ethiopia is:
- Confirmed Cases: ${data.confirmed_cases}
- Total Deaths: ${data.deaths}
- Case Fatality Rate (CFR): ${data.case_fatality_rate}%
- Recovered Cases: ${data.recovered_cases}
- Patients On Treatment: ${data.on_treatment}
- Risk Level: ${data.risk_level.toUpperCase()}
- Priority Actions: ${data.recommendations.slice(0, 3).join(', ')}.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(API_URL + API_KEY, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;
                    
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    outputText.textContent = text;
                    if (sources.length > 0) {
                        outputSources.innerHTML = `Grounded in external sources: ${sources.map(s => `<a href="${s.uri}" target="_blank" class="text-blue-600 hover:text-blue-800 underline">${s.title}</a>`).join(', ')}`;
                    } else {
                        outputSources.textContent = 'Grounded using Google Search, but no specific web source citation was returned.';
                    }

                } else {
                    outputText.textContent = "AI drafting failed. The model returned no text content.";
                    outputError.classList.remove('hidden');
                }

            } catch (e) {
                console.error("Gemini API Error:", e);
                outputText.textContent = "A critical error occurred while contacting the AI service.";
                outputError.classList.remove('hidden');
            } finally {
                // Reset button state
                button.disabled = false;
                button.textContent = 'Generate Public Bulletin Draft (via AI)';
            }
        };

        // --- INITIALIZATION ---

        const startLiveUpdates = () => {
            // Initial load (isLive = false for static report/analysis rendering)
            renderDashboard(false); 

            // Set interval to update only the dashboard metrics every 15 seconds
            setInterval(() => {
                renderDashboard(true); // isLive = true to enable data drift simulation
                console.log('Dashboard metrics updated automatically.');
            }, 15000); 
        };

        const init = () => {
            try {
                startLiveUpdates();
                
                // Set current year in footer
                document.getElementById('year').textContent = new Date().getFullYear();

                // Mobile menu toggle
                document.getElementById('menu-button').addEventListener('click', () => {
                    document.getElementById('mobile-menu').classList.toggle('hidden');
                });
            } catch (error) {
                console.error("Initialization Error:", error);
                alert("Failed to initialize dashboard data. Check console for details.");
            }
        };

        window.onload = init;
    </script>
</body>
</html>       

              
           
